<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- 
      The Script Interpreter
 parameters will be replaced with the 
      document title extracted from the <h1> element or
      file name, if there is no <h1> heading
    -->
    <title>Script Interpreter
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="content/style.css" />
    <script src="content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Bitcoin F#</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="index.html">Intro</a></li>
            <li><a href="Protocol.html">Protocol</a></li>
            <li><a href="DB.html">Persistence</a></li>
            <li><a href="P2P.html">Peer to Peer</a></li>
            <li><a href="Peer.html">Peer</a></li>
            <li><a href="Tracker.html">Tracker</a></li>
            <li><a href="Script.html">Script Interpreter</a></li>
            <li><a href="Mempool.html">Mempool</a></li>
            <li><a href="Checks.html">Validation</a></li>
            <li><a href="Blockchain.html">Blockchain</a></li>
            <li><a href="Main.html">Main</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div class="container">
      <div class="row" style="margin-top:70px">
        <div class="span1"></div>
        <div class="span10" id="main">
          <h1>Script Interpreter</h1>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">module</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">Script</span></pre>
</td>
</tr>
</table>

<p>This module implements an interpreter for the Bitcoin <a href="https://en.bitcoin.it/wiki/Script">Script</a> language. The link points to a good documentation
and I will just mention the main charateristics of this language. For more details, refer to the link.</p>

<p>Bitcoin script is a stack based mainly arithmetic language. There are operators to push data to the stack and
perform operations on the elements of the stack. The stack is made of arbitrary long binary strings. When used for
math operations, these byte strings are considered big integers.</p>

<p>The language has IF/THEN/ELSE but no loops. It is therefore non Turing complete and program execution time is bounded.
Besides the classic operators, it has specific additions such as hashing operators and signature verification.</p>

<p>When a transaction produces Outputs, they mention a value and a script. The later is similar to a program split in two. To 
spend the output, one must provide the other half of the program such as the full program executes successfully.
Another way to see it is to consider the output as a challenge and the spending transaction as the answer to the challenge.</p>

<p>Most of the transactions use the Pay-To-PubHash script. The script has a 20 byte long hash value and the spending transaction
must provide a pub key that hashes to the given value and a signature that matches both the pub key and the transaction content.</p>

<p>However, many other scripts exist even though only a few are considered standard. Standard scripts have been created to 
fulfill a particular use case and are recognized by the core client. The later will not relay transactions that contain
non standard scripts. This node does not care and will relay anything that validates successfully.</p>

<p>This part of Bitcoin has a few special cases that are due to bugs or bug fixes. I will mention their impact as I walk through the code.</p>

<h2>Bitcoin Elliptic Curve secp256k1</h2>

<p>Import the EC that Bitcoin uses.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">secp256k1Curve</span> <span class="o">=</span> <span class="i">Org</span><span class="o">.</span><span class="i">BouncyCastle</span><span class="o">.</span><span class="i">Asn1</span><span class="o">.</span><span class="i">Sec</span><span class="o">.</span><span class="i">SecNamedCurves</span><span class="o">.</span><span class="i">GetByName</span>(<span class="s">&quot;</span><span class="s">secp256k1</span><span class="s">&quot;</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="i">ecDomain</span> <span class="o">=</span> <span class="k">new</span> <span class="i">ECDomainParameters</span>(<span onmouseout="hideTip(event, 'fs8', 13)" onmouseover="showTip(event, 'fs8', 13)" class="i">secp256k1Curve</span><span class="o">.</span><span class="i">Curve</span>, <span onmouseout="hideTip(event, 'fs8', 14)" onmouseover="showTip(event, 'fs8', 14)" class="i">secp256k1Curve</span><span class="o">.</span><span class="i">G</span>, <span onmouseout="hideTip(event, 'fs8', 15)" onmouseover="showTip(event, 'fs8', 15)" class="i">secp256k1Curve</span><span class="o">.</span><span class="i">N</span>)</pre>
</td>
</tr>
</table>

<h2>Commonly used op codes.</h2>

<p>Other op codes are implemented but are seldom used. I left their numeric value in the code.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 16)" onmouseover="showTip(event, 'fs10', 16)" class="i">OP_DUP</span> <span class="o">=</span> <span class="n">118uy</span> <span class="c">// duplicate the last element on the stack</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 17)" onmouseover="showTip(event, 'fs11', 17)" class="i">OP_1</span> <span class="o">=</span> <span class="n">81uy</span> <span class="c">// push 1</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 18)" onmouseover="showTip(event, 'fs12', 18)" class="i">OP_16</span> <span class="o">=</span> <span class="n">96uy</span> <span class="c">// push 16</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 19)" onmouseover="showTip(event, 'fs13', 19)" class="i">OP_HASH160</span> <span class="o">=</span> <span class="n">169uy</span> <span class="c">// Replace the top of the stack by its HASH-160 value (= SHA then RIPEMD)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 20)" onmouseover="showTip(event, 'fs14', 20)" class="i">OP_DATA_20</span> <span class="o">=</span> <span class="n">20uy</span> <span class="c">// Push the next 20 bytes on the stack</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 21)" onmouseover="showTip(event, 'fs15', 21)" class="i">OP_DATA_32</span> <span class="o">=</span> <span class="n">32uy</span> <span class="c">// Push the next 32 bytes on the stack</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 22)" onmouseover="showTip(event, 'fs16', 22)" class="i">OP_EQUAL</span> <span class="o">=</span> <span class="n">135uy</span> <span class="c">// Compare the top two elements</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 23)" onmouseover="showTip(event, 'fs17', 23)" class="i">OP_EQUALVERIFY</span> <span class="o">=</span> <span class="n">136uy</span> <span class="c">// Do the same as above but fail the script if they are not equal</span>
[&lt;<span onmouseout="hideTip(event, 'fs18', 24)" onmouseover="showTip(event, 'fs18', 24)" class="i">Literal</span>&gt;] 
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 25)" onmouseover="showTip(event, 'fs19', 25)" class="i">OP_CHECKSIG</span> <span class="o">=</span> <span class="n">172uy</span> <span class="c">// Single signature check</span>
[&lt;<span onmouseout="hideTip(event, 'fs18', 26)" onmouseover="showTip(event, 'fs18', 26)" class="i">Literal</span>&gt;] 
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 27)" onmouseover="showTip(event, 'fs20', 27)" class="i">OP_CHECKSIGVERIFY</span> <span class="o">=</span> <span class="n">173uy</span> <span class="c">// As above and fail the script if the check doesn&#39;t succeed</span>
[&lt;<span onmouseout="hideTip(event, 'fs18', 28)" onmouseover="showTip(event, 'fs18', 28)" class="i">Literal</span>&gt;] 
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 29)" onmouseover="showTip(event, 'fs21', 29)" class="i">OP_CHECKMULTISIG</span> <span class="o">=</span> <span class="n">174uy</span> <span class="c">// Multi signature check</span>
[&lt;<span onmouseout="hideTip(event, 'fs18', 30)" onmouseover="showTip(event, 'fs18', 30)" class="i">Literal</span>&gt;] 
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 31)" onmouseover="showTip(event, 'fs22', 31)" class="i">OP_CHECKMULTISIGVERIFY</span> <span class="o">=</span> <span class="n">175uy</span> <span class="c">// As above and fail the script if the check doesn&#39;t succeed</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 32)" onmouseover="showTip(event, 'fs23', 32)" class="i">OP_DATA_65</span> <span class="o">=</span> <span class="n">65uy</span> <span class="c">// Push the next 65 bytes on the stack</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 33)" onmouseover="showTip(event, 'fs24', 33)" class="i">OP_DATA_33</span> <span class="o">=</span> <span class="n">33uy</span> <span class="c">// Push the next 33 bytes on the stack</span></pre>
</td>
</tr>
</table>

<h2>P2SH</h2>

<p>Pay to Script Hash is specified in <a href="https://github.com/bitcoin/bips/blob/master/bip-0016.mediawiki">BIP-16</a> and has its own address space. P2SH is quite odd. The script itself is
half the story. It is first verified normally like any other script but then the evaluator recognizes a special script pattern and does
something completely different. It is as if the program said <code>print hello</code> but then starts calculating pi.</p>

<p>Anyway, the idea is that the signing script gives the signatures but also the pub script that it is signing. Normally, 
you would have two scripts that once stitched together form a program. P2SH has a script inside a script. That script is provided as data
pushed into the stack but that data is then poped and evaluated.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// This test is the first of a few checks</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 52)" onmouseover="showTip(event, 'fs31', 52)" class="i">isP2SH</span> (<span onmouseout="hideTip(event, 'fs26', 53)" onmouseover="showTip(event, 'fs26', 53)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 54)" onmouseover="showTip(event, 'fs27', 54)" class="i">byte</span>[]) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs26', 55)" onmouseover="showTip(event, 'fs26', 55)" class="i">script</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 56)" onmouseover="showTip(event, 'fs28', 56)" class="i">Length</span> <span class="o">=</span> <span class="n">23</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs26', 57)" onmouseover="showTip(event, 'fs26', 57)" class="i">script</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 58)" onmouseover="showTip(event, 'fs13', 58)" class="i">OP_HASH160</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs26', 59)" onmouseover="showTip(event, 'fs26', 59)" class="i">script</span><span class="o">.</span>[<span class="n">1</span>] <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 60)" onmouseover="showTip(event, 'fs14', 60)" class="i">OP_DATA_20</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs26', 61)" onmouseover="showTip(event, 'fs26', 61)" class="i">script</span><span class="o">.</span>[<span class="n">22</span>] <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 62)" onmouseover="showTip(event, 'fs16', 62)" class="i">OP_EQUAL</span></pre>
</td>
</tr>
</table>

<h2>Signature verification</h2>

<p>Signature verification is one of the most expensive steps in verification. Bitcoin core uses the OPENSSL library but
this application uses another implementation specially written for Bitcoin. It is significantly faster. However, it may
have incompatibilities.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 63)" onmouseover="showTip(event, 'fs32', 63)" class="i">ECDSACheck</span> (<span onmouseout="hideTip(event, 'fs33', 64)" onmouseover="showTip(event, 'fs33', 64)" class="i">txHash</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 65)" onmouseover="showTip(event, 'fs27', 65)" class="i">byte</span>[], <span onmouseout="hideTip(event, 'fs34', 66)" onmouseover="showTip(event, 'fs34', 66)" class="i">pub</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 67)" onmouseover="showTip(event, 'fs27', 67)" class="i">byte</span>[], <span onmouseout="hideTip(event, 'fs35', 68)" onmouseover="showTip(event, 'fs35', 68)" class="i">signature</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 69)" onmouseover="showTip(event, 'fs27', 69)" class="i">byte</span>[]) <span class="o">=</span> 
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs35', 70)" onmouseover="showTip(event, 'fs35', 70)" class="i">signature</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 71)" onmouseover="showTip(event, 'fs28', 71)" class="i">Length</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs34', 72)" onmouseover="showTip(event, 'fs34', 72)" class="i">pub</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 73)" onmouseover="showTip(event, 'fs28', 73)" class="i">Length</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span> <span class="c">// 0 length signature or pub keys crash the library</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 74)" onmouseover="showTip(event, 'fs36', 74)" class="i">result</span> <span class="o">=</span> <span class="i">Signatures</span><span class="o">.</span><span class="i">Verify</span>(<span onmouseout="hideTip(event, 'fs33', 75)" onmouseover="showTip(event, 'fs33', 75)" class="i">txHash</span>, <span onmouseout="hideTip(event, 'fs35', 76)" onmouseover="showTip(event, 'fs35', 76)" class="i">signature</span>, <span onmouseout="hideTip(event, 'fs34', 77)" onmouseover="showTip(event, 'fs34', 77)" class="i">pub</span>)
        <span onmouseout="hideTip(event, 'fs36', 78)" onmouseover="showTip(event, 'fs36', 78)" class="i">result</span> <span class="o">=</span> <span class="i">Signatures</span><span class="o">.</span><span class="i">VerifyResult</span><span class="o">.</span><span class="i">Verified</span>
    <span class="k">else</span> <span class="k">false</span>
    <span class="c">(* // The Bouncy Castle way</span>
<span class="c">    let signer = new ECDsaSigner()</span>
<span class="c">    let pubKey = new ECPublicKeyParameters(secp256k1Curve.Curve.DecodePoint pub, ecDomain)</span>
<span class="c">    signer.Init(false, pubKey)</span>
<span class="c">    let parser = new Asn1StreamParser(signature)</span>
<span class="c">    let sequence = parser.ReadObject().ToAsn1Object() :?&gt; DerSequence</span>
<span class="c">    let r = sequence.[0] :?&gt; DerInteger</span>
<span class="c">    let s = sequence.[1] :?&gt; DerInteger</span>

<span class="c">    signer.VerifySignature(txHash, r.Value, s.Value)</span>
<span class="c">    *)</span></pre>
</td>
</tr>
</table>

<h2>Stack</h2>

<p>The stack is implemented as a .NET List, i.e. a variable size array. Its elements are native byte arrays.
I added extension methods so that I can use the array as a stack with push &amp; pop.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs37', 79)" onmouseover="showTip(event, 'fs37', 79)" class="i">List</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span><span class="o">&gt;</span> <span class="k">with</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs38', 80)" onmouseover="showTip(event, 'fs38', 80)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 81)" onmouseover="showTip(event, 'fs39', 81)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs40', 82)" onmouseover="showTip(event, 'fs40', 82)" class="i">v</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span>) <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs38', 83)" onmouseover="showTip(event, 'fs38', 83)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 84)" onmouseover="showTip(event, 'fs41', 84)" class="i">Add</span>(<span onmouseout="hideTip(event, 'fs40', 85)" onmouseover="showTip(event, 'fs40', 85)" class="i">v</span>)
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs38', 86)" onmouseover="showTip(event, 'fs38', 86)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 87)" onmouseover="showTip(event, 'fs42', 87)" class="i">Pop</span>() <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs40', 88)" onmouseover="showTip(event, 'fs40', 88)" class="i">v</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs38', 89)" onmouseover="showTip(event, 'fs38', 89)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 90)" onmouseover="showTip(event, 'fs43', 90)" class="i">Peek</span>()
        <span onmouseout="hideTip(event, 'fs38', 91)" onmouseover="showTip(event, 'fs38', 91)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs44', 92)" onmouseover="showTip(event, 'fs44', 92)" class="i">RemoveAt</span>(<span onmouseout="hideTip(event, 'fs38', 93)" onmouseover="showTip(event, 'fs38', 93)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 94)" onmouseover="showTip(event, 'fs45', 94)" class="i">Count</span><span class="o">-</span><span class="n">1</span>)
        <span onmouseout="hideTip(event, 'fs40', 95)" onmouseover="showTip(event, 'fs40', 95)" class="i">v</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs38', 96)" onmouseover="showTip(event, 'fs38', 96)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs46', 97)" onmouseover="showTip(event, 'fs46', 97)" class="i">Peek</span>() <span class="o">=</span> <span onmouseout="hideTip(event, 'fs38', 98)" onmouseover="showTip(event, 'fs38', 98)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 99)" onmouseover="showTip(event, 'fs47', 99)" class="i">Item</span>(<span onmouseout="hideTip(event, 'fs38', 100)" onmouseover="showTip(event, 'fs38', 100)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 101)" onmouseover="showTip(event, 'fs45', 101)" class="i">Count</span><span class="o">-</span><span class="n">1</span>)

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs48', 102)" onmouseover="showTip(event, 'fs48', 102)" class="i">ByteList</span>() <span class="o">=</span>
    <span class="k">inherit</span> <span onmouseout="hideTip(event, 'fs37', 103)" onmouseover="showTip(event, 'fs37', 103)" class="i">List</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs27', 104)" onmouseover="showTip(event, 'fs27', 104)" class="i">byte</span>[]<span class="o">&gt;</span>()
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs49', 105)" onmouseover="showTip(event, 'fs49', 105)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs50', 106)" onmouseover="showTip(event, 'fs50', 106)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs51', 107)" onmouseover="showTip(event, 'fs51', 107)" class="i">v</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 108)" onmouseover="showTip(event, 'fs27', 108)" class="i">byte</span>[]) <span class="o">=</span> 
        <span class="c">// logger.DebugF &quot;Pushing %s&quot; (Hex.ToHexString v)</span>
        <span class="k">base</span><span class="o">.</span><span class="i">Add</span>(<span onmouseout="hideTip(event, 'fs51', 109)" onmouseover="showTip(event, 'fs51', 109)" class="i">v</span>)</pre>
</td>
</tr>
</table>

<h2>Compute the signature hash</h2>

<p>The signature is applied on a given document. Instead of signing the entire document, one first calculates
a hash of the document and signs the hash. Bitcoin has a specific way to create the hash and it depends on 
a few parameters.</p>

<ul>
<li>the signature type. Most of the time, it's SIGHASH<em>ALL and the complete transaction is hashed. After that, 
changing a single byte of the transaction invalidates the signature. But it can be SIGHASH</em>NONE for which all
the outputs are blanked meaning that the signature will remain valid even if the outputs are changed. It can
also be SIGHASH_SINGLE. In the last case, all the outputs except the one with the same index as the input signature
are blanked. It means that all the outputs can be changed except one.</li>
<li>anyone can pay: Another type of signature where the inputs are blanked giving a signature that remains valid even if more
inputs are added later.</li>
</ul>

<p>The signing process is described <a href="https://en.bitcoin.it/wiki/Script">here</a>.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
<span class="l">58: </span>
<span class="l">59: </span>
<span class="l">60: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs59', 129)" onmouseover="showTip(event, 'fs59', 129)" class="i">computeTxHash</span> (<span onmouseout="hideTip(event, 'fs60', 130)" onmouseover="showTip(event, 'fs60', 130)" class="i">tx</span><span class="o">:</span> <span class="i">Tx</span>) (<span onmouseout="hideTip(event, 'fs61', 131)" onmouseover="showTip(event, 'fs61', 131)" class="i">index</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs58', 132)" onmouseover="showTip(event, 'fs58', 132)" class="i">int</span>) (<span onmouseout="hideTip(event, 'fs62', 133)" onmouseover="showTip(event, 'fs62', 133)" class="i">subScript</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 134)" onmouseover="showTip(event, 'fs27', 134)" class="i">byte</span>[]) (<span onmouseout="hideTip(event, 'fs63', 135)" onmouseover="showTip(event, 'fs63', 135)" class="i">sigType</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 136)" onmouseover="showTip(event, 'fs27', 136)" class="i">byte</span>) <span class="o">=</span> 
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs64', 137)" onmouseover="showTip(event, 'fs64', 137)" class="i">returnBuggyHash</span> <span class="o">=</span> <span class="k">false</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs65', 138)" onmouseover="showTip(event, 'fs65', 138)" class="i">anyoneCanPay</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs63', 139)" onmouseover="showTip(event, 'fs63', 139)" class="i">sigType</span> <span class="o">&amp;&amp;&amp;</span> <span class="n">0x80uy</span>) <span class="o">&lt;&gt;</span> <span class="n">0uy</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 140)" onmouseover="showTip(event, 'fs66', 140)" class="i">sigHashType</span> <span class="o">=</span> 
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs63', 141)" onmouseover="showTip(event, 'fs63', 141)" class="i">sigType</span> <span class="o">&amp;&amp;&amp;</span> <span class="n">0x1Fuy</span> <span class="k">with</span>
        | <span class="n">2uy</span> <span class="k">-&gt;</span> <span class="n">2uy</span>
        | <span class="n">3uy</span> <span class="k">-&gt;</span> <span class="n">3uy</span>
        | _ <span class="k">-&gt;</span> <span class="n">1uy</span>
    <span class="k">use</span> <span onmouseout="hideTip(event, 'fs67', 142)" onmouseover="showTip(event, 'fs67', 142)" class="i">oms</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs68', 143)" onmouseover="showTip(event, 'fs68', 143)" class="i">MemoryStream</span>()
    <span class="k">use</span> <span onmouseout="hideTip(event, 'fs69', 144)" onmouseover="showTip(event, 'fs69', 144)" class="i">writer</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs70', 145)" onmouseover="showTip(event, 'fs70', 145)" class="i">BinaryWriter</span>(<span onmouseout="hideTip(event, 'fs67', 146)" onmouseover="showTip(event, 'fs67', 146)" class="i">oms</span>)
    <span onmouseout="hideTip(event, 'fs69', 147)" onmouseover="showTip(event, 'fs69', 147)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 148)" onmouseover="showTip(event, 'fs71', 148)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs60', 149)" onmouseover="showTip(event, 'fs60', 149)" class="i">tx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs72', 150)" onmouseover="showTip(event, 'fs72', 150)" class="i">Version</span>)

    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs65', 151)" onmouseover="showTip(event, 'fs65', 151)" class="i">anyoneCanPay</span> <span class="k">then</span> <span class="c">// reduce to a single input</span>
        <span onmouseout="hideTip(event, 'fs69', 152)" onmouseover="showTip(event, 'fs69', 152)" class="i">writer</span><span class="o">.</span><span class="i">WriteVarInt</span>(<span class="n">1</span>)
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs73', 153)" onmouseover="showTip(event, 'fs73', 153)" class="i">txIn2</span> <span class="o">=</span> <span class="k">new</span> <span class="i">TxIn</span>(<span onmouseout="hideTip(event, 'fs60', 154)" onmouseover="showTip(event, 'fs60', 154)" class="i">tx</span><span class="o">.</span><span class="i">TxIns</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs61', 155)" onmouseover="showTip(event, 'fs61', 155)" class="i">index</span>]<span class="o">.</span><span class="i">PrevOutPoint</span>, <span onmouseout="hideTip(event, 'fs62', 156)" onmouseover="showTip(event, 'fs62', 156)" class="i">subScript</span>, <span onmouseout="hideTip(event, 'fs60', 157)" onmouseover="showTip(event, 'fs60', 157)" class="i">tx</span><span class="o">.</span><span class="i">TxIns</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs61', 158)" onmouseover="showTip(event, 'fs61', 158)" class="i">index</span>]<span class="o">.</span><span class="i">Sequence</span>)
        <span onmouseout="hideTip(event, 'fs69', 159)" onmouseover="showTip(event, 'fs69', 159)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 160)" onmouseover="showTip(event, 'fs71', 160)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs73', 161)" onmouseover="showTip(event, 'fs73', 161)" class="i">txIn2</span><span class="o">.</span><span class="i">ToByteArray</span>())
    <span class="k">else</span> <span class="c">// otherwise keep the other inputs but blank their script </span>
        <span onmouseout="hideTip(event, 'fs69', 162)" onmouseover="showTip(event, 'fs69', 162)" class="i">writer</span><span class="o">.</span><span class="i">WriteVarInt</span>(<span onmouseout="hideTip(event, 'fs60', 163)" onmouseover="showTip(event, 'fs60', 163)" class="i">tx</span><span class="o">.</span><span class="i">TxIns</span><span class="o">.</span><span class="i">Length</span>)
        <span onmouseout="hideTip(event, 'fs60', 164)" onmouseover="showTip(event, 'fs60', 164)" class="i">tx</span><span class="o">.</span><span class="i">TxIns</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs74', 165)" onmouseover="showTip(event, 'fs74', 165)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs75', 166)" onmouseover="showTip(event, 'fs75', 166)" class="i">iteri</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs57', 167)" onmouseover="showTip(event, 'fs57', 167)" class="i">i</span> <span onmouseout="hideTip(event, 'fs76', 168)" onmouseover="showTip(event, 'fs76', 168)" class="i">txIn</span> <span class="k">-&gt;</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 169)" onmouseover="showTip(event, 'fs26', 169)" class="i">script</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs57', 170)" onmouseover="showTip(event, 'fs57', 170)" class="i">i</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs61', 171)" onmouseover="showTip(event, 'fs61', 171)" class="i">index</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs62', 172)" onmouseover="showTip(event, 'fs62', 172)" class="i">subScript</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs74', 173)" onmouseover="showTip(event, 'fs74', 173)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 174)" onmouseover="showTip(event, 'fs77', 174)" class="i">empty</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs73', 175)" onmouseover="showTip(event, 'fs73', 175)" class="i">txIn2</span> <span class="o">=</span> 
                <span class="k">if</span> <span onmouseout="hideTip(event, 'fs66', 176)" onmouseover="showTip(event, 'fs66', 176)" class="i">sigHashType</span> <span class="o">=</span> <span class="n">3uy</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs57', 177)" onmouseover="showTip(event, 'fs57', 177)" class="i">i</span> <span class="o">&lt;&gt;</span> <span onmouseout="hideTip(event, 'fs61', 178)" onmouseover="showTip(event, 'fs61', 178)" class="i">index</span> <span class="k">then</span> 
                    <span class="k">new</span> <span class="i">TxIn</span>(<span onmouseout="hideTip(event, 'fs76', 179)" onmouseover="showTip(event, 'fs76', 179)" class="i">txIn</span><span class="o">.</span><span class="i">PrevOutPoint</span>, <span onmouseout="hideTip(event, 'fs26', 180)" onmouseover="showTip(event, 'fs26', 180)" class="i">script</span>, <span class="n">0</span>)
                <span class="k">else</span>
                    <span class="k">new</span> <span class="i">TxIn</span>(<span onmouseout="hideTip(event, 'fs76', 181)" onmouseover="showTip(event, 'fs76', 181)" class="i">txIn</span><span class="o">.</span><span class="i">PrevOutPoint</span>, <span onmouseout="hideTip(event, 'fs26', 182)" onmouseover="showTip(event, 'fs26', 182)" class="i">script</span>, <span onmouseout="hideTip(event, 'fs76', 183)" onmouseover="showTip(event, 'fs76', 183)" class="i">txIn</span><span class="o">.</span><span class="i">Sequence</span>)
            <span onmouseout="hideTip(event, 'fs69', 184)" onmouseover="showTip(event, 'fs69', 184)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 185)" onmouseover="showTip(event, 'fs71', 185)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs73', 186)" onmouseover="showTip(event, 'fs73', 186)" class="i">txIn2</span><span class="o">.</span><span class="i">ToByteArray</span>())
        )
    
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs66', 187)" onmouseover="showTip(event, 'fs66', 187)" class="i">sigHashType</span> <span class="k">with</span>
    | <span class="n">1uy</span> <span class="k">-&gt;</span>
        <span onmouseout="hideTip(event, 'fs69', 188)" onmouseover="showTip(event, 'fs69', 188)" class="i">writer</span><span class="o">.</span><span class="i">WriteVarInt</span>(<span onmouseout="hideTip(event, 'fs60', 189)" onmouseover="showTip(event, 'fs60', 189)" class="i">tx</span><span class="o">.</span><span class="i">TxOuts</span><span class="o">.</span><span class="i">Length</span>)
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs78', 190)" onmouseover="showTip(event, 'fs78', 190)" class="i">txOut</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs60', 191)" onmouseover="showTip(event, 'fs60', 191)" class="i">tx</span><span class="o">.</span><span class="i">TxOuts</span> <span class="k">do</span>
            <span onmouseout="hideTip(event, 'fs69', 192)" onmouseover="showTip(event, 'fs69', 192)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 193)" onmouseover="showTip(event, 'fs71', 193)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs78', 194)" onmouseover="showTip(event, 'fs78', 194)" class="i">txOut</span><span class="o">.</span><span class="i">ToByteArray</span>())
    | <span class="n">2uy</span> <span class="k">-&gt;</span>
        <span onmouseout="hideTip(event, 'fs69', 195)" onmouseover="showTip(event, 'fs69', 195)" class="i">writer</span><span class="o">.</span><span class="i">WriteVarInt</span> <span class="n">0</span>
    | <span class="n">3uy</span> <span class="k">-&gt;</span> <span class="c">// Normally in SIGHASH_SINGLE, the number of outputs must exceed the input index but if it&#39;s not the case</span>
    <span class="c">// the reference client returns a hash of 1</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs61', 196)" onmouseover="showTip(event, 'fs61', 196)" class="i">index</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs60', 197)" onmouseover="showTip(event, 'fs60', 197)" class="i">tx</span><span class="o">.</span><span class="i">TxOuts</span><span class="o">.</span><span class="i">Length</span> <span class="k">then</span>
            <span onmouseout="hideTip(event, 'fs64', 198)" onmouseover="showTip(event, 'fs64', 198)" class="i">returnBuggyHash</span> <span class="o">&lt;-</span> <span class="k">true</span>
        <span class="k">else</span>
            <span onmouseout="hideTip(event, 'fs69', 199)" onmouseover="showTip(event, 'fs69', 199)" class="i">writer</span><span class="o">.</span><span class="i">WriteVarInt</span> (<span onmouseout="hideTip(event, 'fs61', 200)" onmouseover="showTip(event, 'fs61', 200)" class="i">index</span><span class="o">+</span><span class="n">1</span>)
            <span class="k">for</span> <span onmouseout="hideTip(event, 'fs79', 201)" onmouseover="showTip(event, 'fs79', 201)" class="i">i</span> <span class="k">in</span> <span class="n">0..</span><span onmouseout="hideTip(event, 'fs61', 202)" onmouseover="showTip(event, 'fs61', 202)" class="i">index</span> <span class="k">do</span>
                <span class="k">if</span> <span onmouseout="hideTip(event, 'fs79', 203)" onmouseover="showTip(event, 'fs79', 203)" class="i">i</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs61', 204)" onmouseover="showTip(event, 'fs61', 204)" class="i">index</span> <span class="k">then</span>
                    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs78', 205)" onmouseover="showTip(event, 'fs78', 205)" class="i">txOut</span> <span class="o">=</span> <span class="k">new</span> <span class="i">TxOut</span>(<span class="o">-</span><span class="n">1L</span>, <span onmouseout="hideTip(event, 'fs74', 206)" onmouseover="showTip(event, 'fs74', 206)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 207)" onmouseover="showTip(event, 'fs77', 207)" class="i">empty</span>)
                    <span onmouseout="hideTip(event, 'fs69', 208)" onmouseover="showTip(event, 'fs69', 208)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 209)" onmouseover="showTip(event, 'fs71', 209)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs78', 210)" onmouseover="showTip(event, 'fs78', 210)" class="i">txOut</span><span class="o">.</span><span class="i">ToByteArray</span>())
                <span class="k">else</span>
                    <span onmouseout="hideTip(event, 'fs69', 211)" onmouseover="showTip(event, 'fs69', 211)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 212)" onmouseover="showTip(event, 'fs71', 212)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs60', 213)" onmouseover="showTip(event, 'fs60', 213)" class="i">tx</span><span class="o">.</span><span class="i">TxOuts</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs79', 214)" onmouseover="showTip(event, 'fs79', 214)" class="i">i</span>]<span class="o">.</span><span class="i">ToByteArray</span>())
    | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs80', 215)" onmouseover="showTip(event, 'fs80', 215)" class="i">ignore</span>() <span class="c">// cannot happen</span>

    <span onmouseout="hideTip(event, 'fs69', 216)" onmouseover="showTip(event, 'fs69', 216)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 217)" onmouseover="showTip(event, 'fs71', 217)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs60', 218)" onmouseover="showTip(event, 'fs60', 218)" class="i">tx</span><span class="o">.</span><span class="i">LockTime</span>)
    <span onmouseout="hideTip(event, 'fs69', 219)" onmouseover="showTip(event, 'fs69', 219)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 220)" onmouseover="showTip(event, 'fs71', 220)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs58', 221)" onmouseover="showTip(event, 'fs58', 221)" class="i">int</span> <span onmouseout="hideTip(event, 'fs63', 222)" onmouseover="showTip(event, 'fs63', 222)" class="i">sigType</span>)

    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs64', 223)" onmouseover="showTip(event, 'fs64', 223)" class="i">returnBuggyHash</span> <span class="k">then</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs81', 224)" onmouseover="showTip(event, 'fs81', 224)" class="i">hash</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs74', 225)" onmouseover="showTip(event, 'fs74', 225)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs82', 226)" onmouseover="showTip(event, 'fs82', 226)" class="i">zeroCreate</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs27', 227)" onmouseover="showTip(event, 'fs27', 227)" class="i">byte</span><span class="o">&gt;</span> <span class="n">32</span>
        <span onmouseout="hideTip(event, 'fs81', 228)" onmouseover="showTip(event, 'fs81', 228)" class="i">hash</span><span class="o">.</span>[<span class="n">0</span>] <span class="o">&lt;-</span> <span class="n">1uy</span>
        <span onmouseout="hideTip(event, 'fs81', 229)" onmouseover="showTip(event, 'fs81', 229)" class="i">hash</span>
    <span class="k">else</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs83', 230)" onmouseover="showTip(event, 'fs83', 230)" class="i">data</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs67', 231)" onmouseover="showTip(event, 'fs67', 231)" class="i">oms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs84', 232)" onmouseover="showTip(event, 'fs84', 232)" class="i">ToArray</span>()
        <span class="i">dsha</span> <span onmouseout="hideTip(event, 'fs83', 233)" onmouseover="showTip(event, 'fs83', 233)" class="i">data</span></pre>
</td>
</tr>
</table>

<h3>Stack element conversion</h3>

<p>These functions are used when integers are put into the stack. They must be converted to byte[]. It's using
variable length byte strings in 1-complement encoding. Therefore there is positive 0 and negative 0.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 234)" onmouseover="showTip(event, 'fs85', 234)" class="i">intToBytes</span> (<span onmouseout="hideTip(event, 'fs57', 235)" onmouseover="showTip(event, 'fs57', 235)" class="i">i</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs58', 236)" onmouseover="showTip(event, 'fs58', 236)" class="i">int</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs86', 237)" onmouseover="showTip(event, 'fs86', 237)" class="i">pos</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs87', 238)" onmouseover="showTip(event, 'fs87', 238)" class="i">abs</span> <span onmouseout="hideTip(event, 'fs57', 239)" onmouseover="showTip(event, 'fs57', 239)" class="i">i</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs88', 240)" onmouseover="showTip(event, 'fs88', 240)" class="i">bi</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs89', 241)" onmouseover="showTip(event, 'fs89', 241)" class="i">BitConverter</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 242)" onmouseover="showTip(event, 'fs90', 242)" class="i">GetBytes</span>(<span onmouseout="hideTip(event, 'fs86', 243)" onmouseover="showTip(event, 'fs86', 243)" class="i">pos</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs91', 244)" onmouseover="showTip(event, 'fs91', 244)" class="i">posTrimIdx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs52', 245)" onmouseover="showTip(event, 'fs52', 245)" class="i">revFind</span> <span onmouseout="hideTip(event, 'fs88', 246)" onmouseover="showTip(event, 'fs88', 246)" class="i">bi</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs92', 247)" onmouseover="showTip(event, 'fs92', 247)" class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs92', 248)" onmouseover="showTip(event, 'fs92', 248)" class="i">b</span> <span class="o">&lt;&gt;</span> <span class="n">0uy</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs93', 249)" onmouseover="showTip(event, 'fs93', 249)" class="i">iTrimIdx</span> <span class="o">=</span> 
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs57', 250)" onmouseover="showTip(event, 'fs57', 250)" class="i">i</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> (<span onmouseout="hideTip(event, 'fs88', 251)" onmouseover="showTip(event, 'fs88', 251)" class="i">bi</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs91', 252)" onmouseover="showTip(event, 'fs91', 252)" class="i">posTrimIdx</span>] <span class="o">&amp;&amp;&amp;</span> <span class="n">0x80uy</span>) <span class="o">&lt;&gt;</span> <span class="n">0uy</span> 
            <span class="k">then</span> <span onmouseout="hideTip(event, 'fs91', 253)" onmouseover="showTip(event, 'fs91', 253)" class="i">posTrimIdx</span> <span class="o">+</span> <span class="n">1</span>
            <span class="k">else</span> <span onmouseout="hideTip(event, 'fs91', 254)" onmouseover="showTip(event, 'fs91', 254)" class="i">posTrimIdx</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs94', 255)" onmouseover="showTip(event, 'fs94', 255)" class="i">bytes</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs88', 256)" onmouseover="showTip(event, 'fs88', 256)" class="i">bi</span><span class="o">.</span>[<span class="n">0..</span><span onmouseout="hideTip(event, 'fs93', 257)" onmouseover="showTip(event, 'fs93', 257)" class="i">iTrimIdx</span>]
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs57', 258)" onmouseover="showTip(event, 'fs57', 258)" class="i">i</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">then</span>
        <span onmouseout="hideTip(event, 'fs94', 259)" onmouseover="showTip(event, 'fs94', 259)" class="i">bytes</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs93', 260)" onmouseover="showTip(event, 'fs93', 260)" class="i">iTrimIdx</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs94', 261)" onmouseover="showTip(event, 'fs94', 261)" class="i">bytes</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs93', 262)" onmouseover="showTip(event, 'fs93', 262)" class="i">iTrimIdx</span>] <span class="o">|||</span> <span class="n">0x80uy</span>
    <span onmouseout="hideTip(event, 'fs94', 263)" onmouseover="showTip(event, 'fs94', 263)" class="i">bytes</span>
        
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs95', 264)" onmouseover="showTip(event, 'fs95', 264)" class="i">bytesToInt</span> (<span onmouseout="hideTip(event, 'fs94', 265)" onmouseover="showTip(event, 'fs94', 265)" class="i">bytes</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 266)" onmouseover="showTip(event, 'fs27', 266)" class="i">byte</span>[]) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs96', 267)" onmouseover="showTip(event, 'fs96', 267)" class="i">b</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs74', 268)" onmouseover="showTip(event, 'fs74', 268)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs82', 269)" onmouseover="showTip(event, 'fs82', 269)" class="i">zeroCreate</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs27', 270)" onmouseover="showTip(event, 'fs27', 270)" class="i">byte</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs94', 271)" onmouseover="showTip(event, 'fs94', 271)" class="i">bytes</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 272)" onmouseover="showTip(event, 'fs28', 272)" class="i">Length</span>
    <span onmouseout="hideTip(event, 'fs74', 273)" onmouseover="showTip(event, 'fs74', 273)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 274)" onmouseover="showTip(event, 'fs97', 274)" class="i">Copy</span>(<span onmouseout="hideTip(event, 'fs94', 275)" onmouseover="showTip(event, 'fs94', 275)" class="i">bytes</span>, <span onmouseout="hideTip(event, 'fs96', 276)" onmouseover="showTip(event, 'fs96', 276)" class="i">b</span>, <span onmouseout="hideTip(event, 'fs94', 277)" onmouseover="showTip(event, 'fs94', 277)" class="i">bytes</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 278)" onmouseover="showTip(event, 'fs28', 278)" class="i">Length</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs98', 279)" onmouseover="showTip(event, 'fs98', 279)" class="i">neg</span> <span class="o">=</span> 
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs96', 280)" onmouseover="showTip(event, 'fs96', 280)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 281)" onmouseover="showTip(event, 'fs28', 281)" class="i">Length</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs96', 282)" onmouseover="showTip(event, 'fs96', 282)" class="i">b</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs96', 283)" onmouseover="showTip(event, 'fs96', 283)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 284)" onmouseover="showTip(event, 'fs28', 284)" class="i">Length</span><span class="o">-</span><span class="n">1</span>] <span class="o">&amp;&amp;&amp;</span> <span class="n">0x80uy</span> <span class="o">&lt;&gt;</span> <span class="n">0uy</span> <span class="k">then</span>
            <span onmouseout="hideTip(event, 'fs96', 285)" onmouseover="showTip(event, 'fs96', 285)" class="i">b</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs96', 286)" onmouseover="showTip(event, 'fs96', 286)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 287)" onmouseover="showTip(event, 'fs28', 287)" class="i">Length</span><span class="o">-</span><span class="n">1</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs96', 288)" onmouseover="showTip(event, 'fs96', 288)" class="i">b</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs96', 289)" onmouseover="showTip(event, 'fs96', 289)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 290)" onmouseover="showTip(event, 'fs28', 290)" class="i">Length</span><span class="o">-</span><span class="n">1</span>] <span class="o">&amp;&amp;&amp;</span> <span class="n">0x7Fuy</span>
            <span class="k">true</span>
        <span class="k">else</span> <span class="k">false</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs99', 291)" onmouseover="showTip(event, 'fs99', 291)" class="i">bi</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs100', 292)" onmouseover="showTip(event, 'fs100', 292)" class="i">bigint</span> <span onmouseout="hideTip(event, 'fs96', 293)" onmouseover="showTip(event, 'fs96', 293)" class="i">b</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs98', 294)" onmouseover="showTip(event, 'fs98', 294)" class="i">neg</span> <span class="k">then</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs99', 295)" onmouseover="showTip(event, 'fs99', 295)" class="i">bi</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs99', 296)" onmouseover="showTip(event, 'fs99', 296)" class="i">bi</span></pre>
</td>
</tr>
</table>

<h2>Interpreter</h2>

<p>The interpreter takes a transaction hashing function at construction. When the function is applied, the index
of the input matters and will not give the same hash.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs101', 297)" onmouseover="showTip(event, 'fs101', 297)" class="i">ScriptRuntime</span>(<span onmouseout="hideTip(event, 'fs102', 298)" onmouseover="showTip(event, 'fs102', 298)" class="i">getTxHash</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 299)" onmouseover="showTip(event, 'fs27', 299)" class="i">byte</span>[] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs27', 300)" onmouseover="showTip(event, 'fs27', 300)" class="i">byte</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs27', 301)" onmouseover="showTip(event, 'fs27', 301)" class="i">byte</span>[]) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs103', 302)" onmouseover="showTip(event, 'fs103', 302)" class="i">evalStack</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs48', 303)" onmouseover="showTip(event, 'fs48', 303)" class="i">ByteList</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs104', 304)" onmouseover="showTip(event, 'fs104', 304)" class="i">altStack</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs48', 305)" onmouseover="showTip(event, 'fs48', 305)" class="i">ByteList</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs105', 306)" onmouseover="showTip(event, 'fs105', 306)" class="i">ifStack</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs37', 307)" onmouseover="showTip(event, 'fs37', 307)" class="i">List</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs55', 308)" onmouseover="showTip(event, 'fs55', 308)" class="i">bool</span><span class="o">&gt;</span>()
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs106', 309)" onmouseover="showTip(event, 'fs106', 309)" class="i">skipping</span> <span class="o">=</span> <span class="k">false</span>
    <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs107', 310)" onmouseover="showTip(event, 'fs107', 310)" class="i">codeSep</span> <span class="o">=</span> <span class="n">0</span></pre>
</td>
</tr>
</table>

<h3>Basic stack helpers</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs108', 311)" onmouseover="showTip(event, 'fs108', 311)" class="i">checkDepth</span> (<span onmouseout="hideTip(event, 'fs109', 312)" onmouseover="showTip(event, 'fs109', 312)" class="i">stack</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs37', 313)" onmouseover="showTip(event, 'fs37', 313)" class="i">List</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span><span class="o">&gt;</span>) <span onmouseout="hideTip(event, 'fs110', 314)" onmouseover="showTip(event, 'fs110', 314)" class="i">minDepth</span> <span class="o">=</span> 
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs109', 315)" onmouseover="showTip(event, 'fs109', 315)" class="i">stack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 316)" onmouseover="showTip(event, 'fs45', 316)" class="i">Count</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs110', 317)" onmouseover="showTip(event, 'fs110', 317)" class="i">minDepth</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs111', 318)" onmouseover="showTip(event, 'fs111', 318)" class="i">raise</span> (<span class="i">ValidationException</span> <span class="s">&quot;</span><span class="s">not</span><span class="s"> </span><span class="s">enough</span><span class="s"> </span><span class="s">stack</span><span class="s"> </span><span class="s">depth</span><span class="s">&quot;</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs112', 319)" onmouseover="showTip(event, 'fs112', 319)" class="i">popAsBool</span>() <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs108', 320)" onmouseover="showTip(event, 'fs108', 320)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 321)" onmouseover="showTip(event, 'fs103', 321)" class="i">evalStack</span> <span class="n">1</span>
        <span onmouseout="hideTip(event, 'fs95', 322)" onmouseover="showTip(event, 'fs95', 322)" class="i">bytesToInt</span>(<span onmouseout="hideTip(event, 'fs103', 323)" onmouseover="showTip(event, 'fs103', 323)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 324)" onmouseover="showTip(event, 'fs113', 324)" class="i">Pop</span>()) <span class="o">&lt;&gt;</span> <span class="n">0I</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs114', 325)" onmouseover="showTip(event, 'fs114', 325)" class="i">verify</span>() <span class="o">=</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs115', 326)" onmouseover="showTip(event, 'fs115', 326)" class="i">not</span> (<span onmouseout="hideTip(event, 'fs112', 327)" onmouseover="showTip(event, 'fs112', 327)" class="i">popAsBool</span>()) 
        <span class="k">then</span> <span onmouseout="hideTip(event, 'fs111', 328)" onmouseover="showTip(event, 'fs111', 328)" class="i">raise</span> (<span class="i">ValidationException</span> <span class="s">&quot;</span><span class="s">verification</span><span class="s"> </span><span class="s">failed</span><span class="s">&quot;</span>)

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs116', 329)" onmouseover="showTip(event, 'fs116', 329)" class="i">fail</span>() <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs103', 330)" onmouseover="showTip(event, 'fs103', 330)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 331)" onmouseover="showTip(event, 'fs117', 331)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs85', 332)" onmouseover="showTip(event, 'fs85', 332)" class="i">intToBytes</span>(<span class="n">0</span>))
        <span onmouseout="hideTip(event, 'fs111', 333)" onmouseover="showTip(event, 'fs111', 333)" class="i">raise</span> (<span class="i">ValidationException</span> <span class="s">&quot;</span><span class="s">verification</span><span class="s"> </span><span class="s">failed</span><span class="s">&quot;</span>)

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs118', 334)" onmouseover="showTip(event, 'fs118', 334)" class="i">roll</span> <span onmouseout="hideTip(event, 'fs119', 335)" onmouseover="showTip(event, 'fs119', 335)" class="i">n</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs108', 336)" onmouseover="showTip(event, 'fs108', 336)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 337)" onmouseover="showTip(event, 'fs103', 337)" class="i">evalStack</span> <span onmouseout="hideTip(event, 'fs119', 338)" onmouseover="showTip(event, 'fs119', 338)" class="i">n</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs57', 339)" onmouseover="showTip(event, 'fs57', 339)" class="i">i</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 340)" onmouseover="showTip(event, 'fs103', 340)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 341)" onmouseover="showTip(event, 'fs45', 341)" class="i">Count</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs119', 342)" onmouseover="showTip(event, 'fs119', 342)" class="i">n</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 343)" onmouseover="showTip(event, 'fs120', 343)" class="i">top</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 344)" onmouseover="showTip(event, 'fs103', 344)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs121', 345)" onmouseover="showTip(event, 'fs121', 345)" class="i">Item</span> <span onmouseout="hideTip(event, 'fs57', 346)" onmouseover="showTip(event, 'fs57', 346)" class="i">i</span>
        <span onmouseout="hideTip(event, 'fs103', 347)" onmouseover="showTip(event, 'fs103', 347)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs44', 348)" onmouseover="showTip(event, 'fs44', 348)" class="i">RemoveAt</span> <span onmouseout="hideTip(event, 'fs57', 349)" onmouseover="showTip(event, 'fs57', 349)" class="i">i</span>
        <span onmouseout="hideTip(event, 'fs103', 350)" onmouseover="showTip(event, 'fs103', 350)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 351)" onmouseover="showTip(event, 'fs117', 351)" class="i">Push</span> <span onmouseout="hideTip(event, 'fs120', 352)" onmouseover="showTip(event, 'fs120', 352)" class="i">top</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs122', 353)" onmouseover="showTip(event, 'fs122', 353)" class="i">dup</span> <span onmouseout="hideTip(event, 'fs119', 354)" onmouseover="showTip(event, 'fs119', 354)" class="i">n</span> <span onmouseout="hideTip(event, 'fs123', 355)" onmouseover="showTip(event, 'fs123', 355)" class="i">depth</span> <span class="o">=</span>
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs79', 356)" onmouseover="showTip(event, 'fs79', 356)" class="i">i</span> <span class="k">in</span> <span class="n">1..</span><span onmouseout="hideTip(event, 'fs119', 357)" onmouseover="showTip(event, 'fs119', 357)" class="i">n</span> <span class="k">do</span>
            <span onmouseout="hideTip(event, 'fs103', 358)" onmouseover="showTip(event, 'fs103', 358)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 359)" onmouseover="showTip(event, 'fs117', 359)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs103', 360)" onmouseover="showTip(event, 'fs103', 360)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs121', 361)" onmouseover="showTip(event, 'fs121', 361)" class="i">Item</span>(<span onmouseout="hideTip(event, 'fs103', 362)" onmouseover="showTip(event, 'fs103', 362)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 363)" onmouseover="showTip(event, 'fs45', 363)" class="i">Count</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs119', 364)" onmouseover="showTip(event, 'fs119', 364)" class="i">n</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs123', 365)" onmouseover="showTip(event, 'fs123', 365)" class="i">depth</span>))</pre>
</td>
</tr>
</table>

<h3>Operators on stack elements</h3>

<p>They pull a certain number of elements from the stack, apply a function and then
push the result back to the stack. The number of arguements and nature of the operation
varies with the helper.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs124', 366)" onmouseover="showTip(event, 'fs124', 366)" class="i">unaryOp</span> (<span onmouseout="hideTip(event, 'fs125', 367)" onmouseover="showTip(event, 'fs125', 367)" class="i">f</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs58', 368)" onmouseover="showTip(event, 'fs58', 368)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 369)" onmouseover="showTip(event, 'fs58', 369)" class="i">int</span>) <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs108', 370)" onmouseover="showTip(event, 'fs108', 370)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 371)" onmouseover="showTip(event, 'fs103', 371)" class="i">evalStack</span> <span class="n">1</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs126', 372)" onmouseover="showTip(event, 'fs126', 372)" class="i">arg</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 373)" onmouseover="showTip(event, 'fs103', 373)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 374)" onmouseover="showTip(event, 'fs113', 374)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 375)" onmouseover="showTip(event, 'fs95', 375)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 376)" onmouseover="showTip(event, 'fs58', 376)" class="i">int</span>
        <span onmouseout="hideTip(event, 'fs125', 377)" onmouseover="showTip(event, 'fs125', 377)" class="i">f</span>(<span onmouseout="hideTip(event, 'fs126', 378)" onmouseover="showTip(event, 'fs126', 378)" class="i">arg</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs85', 379)" onmouseover="showTip(event, 'fs85', 379)" class="i">intToBytes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs103', 380)" onmouseover="showTip(event, 'fs103', 380)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 381)" onmouseover="showTip(event, 'fs117', 381)" class="i">Push</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs127', 382)" onmouseover="showTip(event, 'fs127', 382)" class="i">binaryOp</span> (<span onmouseout="hideTip(event, 'fs128', 383)" onmouseover="showTip(event, 'fs128', 383)" class="i">f</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs58', 384)" onmouseover="showTip(event, 'fs58', 384)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 385)" onmouseover="showTip(event, 'fs58', 385)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 386)" onmouseover="showTip(event, 'fs58', 386)" class="i">int</span>) <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs108', 387)" onmouseover="showTip(event, 'fs108', 387)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 388)" onmouseover="showTip(event, 'fs103', 388)" class="i">evalStack</span> <span class="n">2</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs129', 389)" onmouseover="showTip(event, 'fs129', 389)" class="i">arg2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 390)" onmouseover="showTip(event, 'fs103', 390)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 391)" onmouseover="showTip(event, 'fs113', 391)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 392)" onmouseover="showTip(event, 'fs95', 392)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 393)" onmouseover="showTip(event, 'fs58', 393)" class="i">int</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs130', 394)" onmouseover="showTip(event, 'fs130', 394)" class="i">arg1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 395)" onmouseover="showTip(event, 'fs103', 395)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 396)" onmouseover="showTip(event, 'fs113', 396)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 397)" onmouseover="showTip(event, 'fs95', 397)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 398)" onmouseover="showTip(event, 'fs58', 398)" class="i">int</span>
        <span onmouseout="hideTip(event, 'fs128', 399)" onmouseover="showTip(event, 'fs128', 399)" class="i">f</span> <span onmouseout="hideTip(event, 'fs130', 400)" onmouseover="showTip(event, 'fs130', 400)" class="i">arg1</span> <span onmouseout="hideTip(event, 'fs129', 401)" onmouseover="showTip(event, 'fs129', 401)" class="i">arg2</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs85', 402)" onmouseover="showTip(event, 'fs85', 402)" class="i">intToBytes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs103', 403)" onmouseover="showTip(event, 'fs103', 403)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 404)" onmouseover="showTip(event, 'fs117', 404)" class="i">Push</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs131', 405)" onmouseover="showTip(event, 'fs131', 405)" class="i">logicalOp</span> (<span onmouseout="hideTip(event, 'fs132', 406)" onmouseover="showTip(event, 'fs132', 406)" class="i">f</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs55', 407)" onmouseover="showTip(event, 'fs55', 407)" class="i">bool</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs55', 408)" onmouseover="showTip(event, 'fs55', 408)" class="i">bool</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs55', 409)" onmouseover="showTip(event, 'fs55', 409)" class="i">bool</span>) <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs108', 410)" onmouseover="showTip(event, 'fs108', 410)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 411)" onmouseover="showTip(event, 'fs103', 411)" class="i">evalStack</span> <span class="n">2</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs133', 412)" onmouseover="showTip(event, 'fs133', 412)" class="i">arg2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 413)" onmouseover="showTip(event, 'fs103', 413)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 414)" onmouseover="showTip(event, 'fs113', 414)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 415)" onmouseover="showTip(event, 'fs95', 415)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 416)" onmouseover="showTip(event, 'fs58', 416)" class="i">int</span> <span class="o">|&gt;</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 417)" onmouseover="showTip(event, 'fs134', 417)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 418)" onmouseover="showTip(event, 'fs134', 418)" class="i">x</span> <span class="o">&lt;&gt;</span> <span class="n">0</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs135', 419)" onmouseover="showTip(event, 'fs135', 419)" class="i">arg1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 420)" onmouseover="showTip(event, 'fs103', 420)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 421)" onmouseover="showTip(event, 'fs113', 421)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 422)" onmouseover="showTip(event, 'fs95', 422)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 423)" onmouseover="showTip(event, 'fs58', 423)" class="i">int</span> <span class="o">|&gt;</span> <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 424)" onmouseover="showTip(event, 'fs134', 424)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 425)" onmouseover="showTip(event, 'fs134', 425)" class="i">x</span> <span class="o">&lt;&gt;</span> <span class="n">0</span>
        <span onmouseout="hideTip(event, 'fs132', 426)" onmouseover="showTip(event, 'fs132', 426)" class="i">f</span> <span onmouseout="hideTip(event, 'fs135', 427)" onmouseover="showTip(event, 'fs135', 427)" class="i">arg1</span> <span onmouseout="hideTip(event, 'fs133', 428)" onmouseover="showTip(event, 'fs133', 428)" class="i">arg2</span> <span class="o">|&gt;</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs136', 429)" onmouseover="showTip(event, 'fs136', 429)" class="i">x</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs136', 430)" onmouseover="showTip(event, 'fs136', 430)" class="i">x</span> <span class="k">then</span> <span class="n">1</span> <span class="k">else</span> <span class="n">0</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs85', 431)" onmouseover="showTip(event, 'fs85', 431)" class="i">intToBytes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs103', 432)" onmouseover="showTip(event, 'fs103', 432)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 433)" onmouseover="showTip(event, 'fs117', 433)" class="i">Push</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs137', 434)" onmouseover="showTip(event, 'fs137', 434)" class="i">binaryBoolOp</span> (<span onmouseout="hideTip(event, 'fs138', 435)" onmouseover="showTip(event, 'fs138', 435)" class="i">f</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs58', 436)" onmouseover="showTip(event, 'fs58', 436)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 437)" onmouseover="showTip(event, 'fs58', 437)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs55', 438)" onmouseover="showTip(event, 'fs55', 438)" class="i">bool</span>) <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs108', 439)" onmouseover="showTip(event, 'fs108', 439)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 440)" onmouseover="showTip(event, 'fs103', 440)" class="i">evalStack</span> <span class="n">2</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs129', 441)" onmouseover="showTip(event, 'fs129', 441)" class="i">arg2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 442)" onmouseover="showTip(event, 'fs103', 442)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 443)" onmouseover="showTip(event, 'fs113', 443)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 444)" onmouseover="showTip(event, 'fs95', 444)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 445)" onmouseover="showTip(event, 'fs58', 445)" class="i">int</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs130', 446)" onmouseover="showTip(event, 'fs130', 446)" class="i">arg1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 447)" onmouseover="showTip(event, 'fs103', 447)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 448)" onmouseover="showTip(event, 'fs113', 448)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 449)" onmouseover="showTip(event, 'fs95', 449)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 450)" onmouseover="showTip(event, 'fs58', 450)" class="i">int</span>
        <span onmouseout="hideTip(event, 'fs138', 451)" onmouseover="showTip(event, 'fs138', 451)" class="i">f</span> <span onmouseout="hideTip(event, 'fs130', 452)" onmouseover="showTip(event, 'fs130', 452)" class="i">arg1</span> <span onmouseout="hideTip(event, 'fs129', 453)" onmouseover="showTip(event, 'fs129', 453)" class="i">arg2</span> <span class="o">|&gt;</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs136', 454)" onmouseover="showTip(event, 'fs136', 454)" class="i">x</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs136', 455)" onmouseover="showTip(event, 'fs136', 455)" class="i">x</span> <span class="k">then</span> <span class="n">1</span> <span class="k">else</span> <span class="n">0</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs85', 456)" onmouseover="showTip(event, 'fs85', 456)" class="i">intToBytes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs103', 457)" onmouseover="showTip(event, 'fs103', 457)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 458)" onmouseover="showTip(event, 'fs117', 458)" class="i">Push</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs139', 459)" onmouseover="showTip(event, 'fs139', 459)" class="i">tertiaryOp</span> (<span onmouseout="hideTip(event, 'fs140', 460)" onmouseover="showTip(event, 'fs140', 460)" class="i">f</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs58', 461)" onmouseover="showTip(event, 'fs58', 461)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 462)" onmouseover="showTip(event, 'fs58', 462)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 463)" onmouseover="showTip(event, 'fs58', 463)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 464)" onmouseover="showTip(event, 'fs58', 464)" class="i">int</span>) <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs108', 465)" onmouseover="showTip(event, 'fs108', 465)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 466)" onmouseover="showTip(event, 'fs103', 466)" class="i">evalStack</span> <span class="n">2</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs141', 467)" onmouseover="showTip(event, 'fs141', 467)" class="i">arg3</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 468)" onmouseover="showTip(event, 'fs103', 468)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 469)" onmouseover="showTip(event, 'fs113', 469)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 470)" onmouseover="showTip(event, 'fs95', 470)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 471)" onmouseover="showTip(event, 'fs58', 471)" class="i">int</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs129', 472)" onmouseover="showTip(event, 'fs129', 472)" class="i">arg2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 473)" onmouseover="showTip(event, 'fs103', 473)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 474)" onmouseover="showTip(event, 'fs113', 474)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 475)" onmouseover="showTip(event, 'fs95', 475)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 476)" onmouseover="showTip(event, 'fs58', 476)" class="i">int</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs130', 477)" onmouseover="showTip(event, 'fs130', 477)" class="i">arg1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 478)" onmouseover="showTip(event, 'fs103', 478)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 479)" onmouseover="showTip(event, 'fs113', 479)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs95', 480)" onmouseover="showTip(event, 'fs95', 480)" class="i">bytesToInt</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 481)" onmouseover="showTip(event, 'fs58', 481)" class="i">int</span>
        <span onmouseout="hideTip(event, 'fs140', 482)" onmouseover="showTip(event, 'fs140', 482)" class="i">f</span> <span onmouseout="hideTip(event, 'fs130', 483)" onmouseover="showTip(event, 'fs130', 483)" class="i">arg1</span> <span onmouseout="hideTip(event, 'fs129', 484)" onmouseover="showTip(event, 'fs129', 484)" class="i">arg2</span> <span onmouseout="hideTip(event, 'fs141', 485)" onmouseover="showTip(event, 'fs141', 485)" class="i">arg3</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs85', 486)" onmouseover="showTip(event, 'fs85', 486)" class="i">intToBytes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs103', 487)" onmouseover="showTip(event, 'fs103', 487)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 488)" onmouseover="showTip(event, 'fs117', 488)" class="i">Push</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs142', 489)" onmouseover="showTip(event, 'fs142', 489)" class="i">hashOp</span> (<span onmouseout="hideTip(event, 'fs143', 490)" onmouseover="showTip(event, 'fs143', 490)" class="i">f</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 491)" onmouseover="showTip(event, 'fs27', 491)" class="i">byte</span>[] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs27', 492)" onmouseover="showTip(event, 'fs27', 492)" class="i">byte</span>[]) <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs108', 493)" onmouseover="showTip(event, 'fs108', 493)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 494)" onmouseover="showTip(event, 'fs103', 494)" class="i">evalStack</span> <span class="n">1</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs83', 495)" onmouseover="showTip(event, 'fs83', 495)" class="i">data</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 496)" onmouseover="showTip(event, 'fs103', 496)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 497)" onmouseover="showTip(event, 'fs113', 497)" class="i">Pop</span>()
        <span onmouseout="hideTip(event, 'fs83', 498)" onmouseover="showTip(event, 'fs83', 498)" class="i">data</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs143', 499)" onmouseover="showTip(event, 'fs143', 499)" class="i">f</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs103', 500)" onmouseover="showTip(event, 'fs103', 500)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 501)" onmouseover="showTip(event, 'fs117', 501)" class="i">Push</span></pre>
</td>
</tr>
</table>

<h3>Remove data that matches a predicate</h3>

<p>This function parses the script quickly and identifies the data parts. The predicate is evaluated
on the data part and if it returns true, the data is <em>removed</em> from the script. Surprisingly, there are
a few places where the standard dictates this behavior.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs144', 502)" onmouseover="showTip(event, 'fs144', 502)" class="i">removeData</span> (<span onmouseout="hideTip(event, 'fs26', 503)" onmouseover="showTip(event, 'fs26', 503)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 504)" onmouseover="showTip(event, 'fs27', 504)" class="i">byte</span>[]) (<span onmouseout="hideTip(event, 'fs145', 505)" onmouseover="showTip(event, 'fs145', 505)" class="i">pred</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 506)" onmouseover="showTip(event, 'fs27', 506)" class="i">byte</span>[] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs55', 507)" onmouseover="showTip(event, 'fs55', 507)" class="i">bool</span>) <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs146', 508)" onmouseover="showTip(event, 'fs146', 508)" class="i">dataList</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs37', 509)" onmouseover="showTip(event, 'fs37', 509)" class="i">List</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs27', 510)" onmouseover="showTip(event, 'fs27', 510)" class="i">byte</span>[]<span class="o">&gt;</span>()
        <span class="k">use</span> <span onmouseout="hideTip(event, 'fs147', 511)" onmouseover="showTip(event, 'fs147', 511)" class="i">ms</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs68', 512)" onmouseover="showTip(event, 'fs68', 512)" class="i">MemoryStream</span>(<span onmouseout="hideTip(event, 'fs26', 513)" onmouseover="showTip(event, 'fs26', 513)" class="i">script</span>)
        <span class="k">use</span> <span onmouseout="hideTip(event, 'fs148', 514)" onmouseover="showTip(event, 'fs148', 514)" class="i">reader</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs149', 515)" onmouseover="showTip(event, 'fs149', 515)" class="i">BinaryReader</span>(<span onmouseout="hideTip(event, 'fs147', 516)" onmouseover="showTip(event, 'fs147', 516)" class="i">ms</span>)
        (
            <span class="k">try</span>
                <span class="k">use</span> <span onmouseout="hideTip(event, 'fs67', 517)" onmouseover="showTip(event, 'fs67', 517)" class="i">oms</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs68', 518)" onmouseover="showTip(event, 'fs68', 518)" class="i">MemoryStream</span>()
                <span class="k">use</span> <span onmouseout="hideTip(event, 'fs69', 519)" onmouseover="showTip(event, 'fs69', 519)" class="i">writer</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs70', 520)" onmouseover="showTip(event, 'fs70', 520)" class="i">BinaryWriter</span>(<span onmouseout="hideTip(event, 'fs67', 521)" onmouseover="showTip(event, 'fs67', 521)" class="i">oms</span>)

                <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs150', 522)" onmouseover="showTip(event, 'fs150', 522)" class="i">removeDataInner</span> ()<span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 523)" onmouseover="showTip(event, 'fs27', 523)" class="i">byte</span>[] <span class="o">=</span>
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs147', 524)" onmouseover="showTip(event, 'fs147', 524)" class="i">ms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs151', 525)" onmouseover="showTip(event, 'fs151', 525)" class="i">Position</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs147', 526)" onmouseover="showTip(event, 'fs147', 526)" class="i">ms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs152', 527)" onmouseover="showTip(event, 'fs152', 527)" class="i">Length</span> <span class="k">then</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs92', 528)" onmouseover="showTip(event, 'fs92', 528)" class="i">b</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs148', 529)" onmouseover="showTip(event, 'fs148', 529)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 530)" onmouseover="showTip(event, 'fs153', 530)" class="i">ReadByte</span>()
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs154', 531)" onmouseover="showTip(event, 'fs154', 531)" class="i">c</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 532)" onmouseover="showTip(event, 'fs58', 532)" class="i">int</span> <span onmouseout="hideTip(event, 'fs92', 533)" onmouseover="showTip(event, 'fs92', 533)" class="i">b</span>
                        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs154', 534)" onmouseover="showTip(event, 'fs154', 534)" class="i">c</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">1</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs154', 535)" onmouseover="showTip(event, 'fs154', 535)" class="i">c</span> <span class="o">&lt;=</span> <span class="n">78</span> <span class="k">then</span>
                            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs155', 536)" onmouseover="showTip(event, 'fs155', 536)" class="i">startPos</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs147', 537)" onmouseover="showTip(event, 'fs147', 537)" class="i">ms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs151', 538)" onmouseover="showTip(event, 'fs151', 538)" class="i">Position</span><span class="o">-</span><span class="n">1L</span>
                            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs156', 539)" onmouseover="showTip(event, 'fs156', 539)" class="i">len</span> <span class="o">=</span> 
                                <span class="k">match</span> <span onmouseout="hideTip(event, 'fs154', 540)" onmouseover="showTip(event, 'fs154', 540)" class="i">c</span> <span class="k">with</span>
                                | <span class="n">76</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 541)" onmouseover="showTip(event, 'fs58', 541)" class="i">int</span> (<span onmouseout="hideTip(event, 'fs148', 542)" onmouseover="showTip(event, 'fs148', 542)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 543)" onmouseover="showTip(event, 'fs153', 543)" class="i">ReadByte</span>())
                                | <span class="n">77</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 544)" onmouseover="showTip(event, 'fs58', 544)" class="i">int</span> (<span onmouseout="hideTip(event, 'fs148', 545)" onmouseover="showTip(event, 'fs148', 545)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs157', 546)" onmouseover="showTip(event, 'fs157', 546)" class="i">ReadInt16</span>())
                                | <span class="n">78</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs148', 547)" onmouseover="showTip(event, 'fs148', 547)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs158', 548)" onmouseover="showTip(event, 'fs158', 548)" class="i">ReadInt32</span>()
                                | <span onmouseout="hideTip(event, 'fs134', 549)" onmouseover="showTip(event, 'fs134', 549)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 550)" onmouseover="showTip(event, 'fs134', 550)" class="i">x</span>
                            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs83', 551)" onmouseover="showTip(event, 'fs83', 551)" class="i">data</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs148', 552)" onmouseover="showTip(event, 'fs148', 552)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs159', 553)" onmouseover="showTip(event, 'fs159', 553)" class="i">ReadBytes</span>(<span onmouseout="hideTip(event, 'fs156', 554)" onmouseover="showTip(event, 'fs156', 554)" class="i">len</span>)
                            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs115', 555)" onmouseover="showTip(event, 'fs115', 555)" class="i">not</span> (<span onmouseout="hideTip(event, 'fs145', 556)" onmouseover="showTip(event, 'fs145', 556)" class="i">pred</span>(<span onmouseout="hideTip(event, 'fs83', 557)" onmouseover="showTip(event, 'fs83', 557)" class="i">data</span>)) <span class="k">then</span>
                                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs160', 558)" onmouseover="showTip(event, 'fs160', 558)" class="i">lenRead</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 559)" onmouseover="showTip(event, 'fs58', 559)" class="i">int</span>(<span onmouseout="hideTip(event, 'fs147', 560)" onmouseover="showTip(event, 'fs147', 560)" class="i">ms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs151', 561)" onmouseover="showTip(event, 'fs151', 561)" class="i">Position</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs155', 562)" onmouseover="showTip(event, 'fs155', 562)" class="i">startPos</span>)
                                <span onmouseout="hideTip(event, 'fs147', 563)" onmouseover="showTip(event, 'fs147', 563)" class="i">ms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs161', 564)" onmouseover="showTip(event, 'fs161', 564)" class="i">Seek</span>(<span onmouseout="hideTip(event, 'fs155', 565)" onmouseover="showTip(event, 'fs155', 565)" class="i">startPos</span>, <span onmouseout="hideTip(event, 'fs162', 566)" onmouseover="showTip(event, 'fs162', 566)" class="i">SeekOrigin</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs163', 567)" onmouseover="showTip(event, 'fs163', 567)" class="i">Begin</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs80', 568)" onmouseover="showTip(event, 'fs80', 568)" class="i">ignore</span>
                                <span onmouseout="hideTip(event, 'fs69', 569)" onmouseover="showTip(event, 'fs69', 569)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 570)" onmouseover="showTip(event, 'fs71', 570)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs148', 571)" onmouseover="showTip(event, 'fs148', 571)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs159', 572)" onmouseover="showTip(event, 'fs159', 572)" class="i">ReadBytes</span>(<span onmouseout="hideTip(event, 'fs160', 573)" onmouseover="showTip(event, 'fs160', 573)" class="i">lenRead</span>))
                            <span class="k">else</span>
                                <span onmouseout="hideTip(event, 'fs146', 574)" onmouseover="showTip(event, 'fs146', 574)" class="i">dataList</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs164', 575)" onmouseover="showTip(event, 'fs164', 575)" class="i">Add</span>(<span onmouseout="hideTip(event, 'fs83', 576)" onmouseover="showTip(event, 'fs83', 576)" class="i">data</span>)
                        <span class="k">else</span>
                            <span onmouseout="hideTip(event, 'fs69', 577)" onmouseover="showTip(event, 'fs69', 577)" class="i">writer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 578)" onmouseover="showTip(event, 'fs71', 578)" class="i">Write</span>(<span onmouseout="hideTip(event, 'fs92', 579)" onmouseover="showTip(event, 'fs92', 579)" class="i">b</span>)
                        <span onmouseout="hideTip(event, 'fs150', 580)" onmouseover="showTip(event, 'fs150', 580)" class="i">removeDataInner</span>()
                    <span class="k">else</span>
                        <span onmouseout="hideTip(event, 'fs67', 581)" onmouseover="showTip(event, 'fs67', 581)" class="i">oms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs84', 582)" onmouseover="showTip(event, 'fs84', 582)" class="i">ToArray</span>()

                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 583)" onmouseover="showTip(event, 'fs26', 583)" class="i">script</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs150', 584)" onmouseover="showTip(event, 'fs150', 584)" class="i">removeDataInner</span>()
                <span onmouseout="hideTip(event, 'fs147', 585)" onmouseover="showTip(event, 'fs147', 585)" class="i">ms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs165', 586)" onmouseover="showTip(event, 'fs165', 586)" class="i">Dispose</span>()
                (<span class="k">true</span>, <span onmouseout="hideTip(event, 'fs26', 587)" onmouseover="showTip(event, 'fs26', 587)" class="i">script</span>, <span onmouseout="hideTip(event, 'fs146', 588)" onmouseover="showTip(event, 'fs146', 588)" class="i">dataList</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs166', 589)" onmouseover="showTip(event, 'fs166', 589)" class="i">ToArray</span>())
            <span class="k">with</span> 
            | <span onmouseout="hideTip(event, 'fs167', 590)" onmouseover="showTip(event, 'fs167', 590)" class="i">e</span> <span class="k">-&gt;</span> 
                <span class="i">logger</span><span class="o">.</span><span class="i">DebugF</span> <span class="s">&quot;</span><span class="s">Invalid</span><span class="s"> </span><span class="s">script</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs167', 591)" onmouseover="showTip(event, 'fs167', 591)" class="i">e</span>
                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs168', 592)" onmouseover="showTip(event, 'fs168', 592)" class="i">currentPos</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 593)" onmouseover="showTip(event, 'fs58', 593)" class="i">int</span> <span onmouseout="hideTip(event, 'fs147', 594)" onmouseover="showTip(event, 'fs147', 594)" class="i">ms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs151', 595)" onmouseover="showTip(event, 'fs151', 595)" class="i">Position</span><span class="o">-</span><span class="n">1</span>
                (<span class="k">false</span>, <span onmouseout="hideTip(event, 'fs26', 596)" onmouseover="showTip(event, 'fs26', 596)" class="i">script</span><span class="o">.</span>[<span class="n">0..</span><span onmouseout="hideTip(event, 'fs168', 597)" onmouseover="showTip(event, 'fs168', 597)" class="i">currentPos</span>], <span onmouseout="hideTip(event, 'fs146', 598)" onmouseover="showTip(event, 'fs146', 598)" class="i">dataList</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs166', 599)" onmouseover="showTip(event, 'fs166', 599)" class="i">ToArray</span>())
        )</pre>
</td>
</tr>
</table>

<h3>Remove the signature bytes from a script</h3>

<p>Because a signature cannot be signed, the algorithm always removes any occurence of the signature
before passing the script to the hashing function</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs169', 600)" onmouseover="showTip(event, 'fs169', 600)" class="i">removeSignatures</span> (<span onmouseout="hideTip(event, 'fs26', 601)" onmouseover="showTip(event, 'fs26', 601)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 602)" onmouseover="showTip(event, 'fs27', 602)" class="i">byte</span>[]) (<span onmouseout="hideTip(event, 'fs170', 603)" onmouseover="showTip(event, 'fs170', 603)" class="i">signatures</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs171', 604)" onmouseover="showTip(event, 'fs171', 604)" class="i">HashSet</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs27', 605)" onmouseover="showTip(event, 'fs27', 605)" class="i">byte</span>[]<span class="o">&gt;</span>) <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs62', 606)" onmouseover="showTip(event, 'fs62', 606)" class="i">subScript</span> <span class="o">=</span> 
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs107', 607)" onmouseover="showTip(event, 'fs107', 607)" class="i">codeSep</span> <span class="o">&lt;&gt;</span> <span class="n">0</span>
                <span class="k">then</span> <span onmouseout="hideTip(event, 'fs26', 608)" onmouseover="showTip(event, 'fs26', 608)" class="i">script</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs107', 609)" onmouseover="showTip(event, 'fs107', 609)" class="i">codeSep</span><span class="o">..</span>]
                <span class="k">else</span> <span onmouseout="hideTip(event, 'fs26', 610)" onmouseover="showTip(event, 'fs26', 610)" class="i">script</span>
        <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs172', 611)" onmouseover="showTip(event, 'fs172', 611)" class="i">success</span>, <span onmouseout="hideTip(event, 'fs26', 612)" onmouseover="showTip(event, 'fs26', 612)" class="i">script</span>, _) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 613)" onmouseover="showTip(event, 'fs144', 613)" class="i">removeData</span> <span onmouseout="hideTip(event, 'fs62', 614)" onmouseover="showTip(event, 'fs62', 614)" class="i">subScript</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs83', 615)" onmouseover="showTip(event, 'fs83', 615)" class="i">data</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs170', 616)" onmouseover="showTip(event, 'fs170', 616)" class="i">signatures</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs173', 617)" onmouseover="showTip(event, 'fs173', 617)" class="i">Contains</span> <span onmouseout="hideTip(event, 'fs83', 618)" onmouseover="showTip(event, 'fs83', 618)" class="i">data</span>)
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs115', 619)" onmouseover="showTip(event, 'fs115', 619)" class="i">not</span> <span onmouseout="hideTip(event, 'fs172', 620)" onmouseover="showTip(event, 'fs172', 620)" class="i">success</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs116', 621)" onmouseover="showTip(event, 'fs116', 621)" class="i">fail</span>() 
        <span onmouseout="hideTip(event, 'fs26', 622)" onmouseover="showTip(event, 'fs26', 622)" class="i">script</span></pre>
</td>
</tr>
</table>

<h3>Calculate the number of OP_CHECKSIG</h3>

<p>This is to protect against scripts that have a large number of OP_CHECKSIG. They are expensive to execute
and without a limit can be used to make the node overwork. It's an anti-DoS measure but is quite painful to
check in practice as every script must be checked even if the tx output is never spent.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs174', 623)" onmouseover="showTip(event, 'fs174', 623)" class="i">scriptCheckSigCount</span> (<span onmouseout="hideTip(event, 'fs26', 624)" onmouseover="showTip(event, 'fs26', 624)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 625)" onmouseover="showTip(event, 'fs27', 625)" class="i">byte</span>[]) <span class="o">=</span>
        <span class="k">let</span> (_, <span onmouseout="hideTip(event, 'fs175', 626)" onmouseover="showTip(event, 'fs175', 626)" class="i">ops</span>, _) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 627)" onmouseover="showTip(event, 'fs144', 627)" class="i">removeData</span> <span onmouseout="hideTip(event, 'fs26', 628)" onmouseover="showTip(event, 'fs26', 628)" class="i">script</span> (<span class="k">fun</span> _ <span class="k">-&gt;</span> <span class="k">true</span>)
        <span onmouseout="hideTip(event, 'fs175', 629)" onmouseover="showTip(event, 'fs175', 629)" class="i">ops</span><span class="o">.</span><span class="i">Prepend</span>(<span class="n">0xFFuy</span>)<span class="o">.</span><span class="i">Window</span>(<span class="n">2</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs176', 630)" onmouseover="showTip(event, 'fs176', 630)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs177', 631)" onmouseover="showTip(event, 'fs177', 631)" class="i">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs178', 632)" onmouseover="showTip(event, 'fs178', 632)" class="i">x</span> <span class="k">-&gt;</span> <span class="c">// Prepend a dummy byte to deal with boundary case</span>
            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs178', 633)" onmouseover="showTip(event, 'fs178', 633)" class="i">x</span><span class="o">.</span><span class="i">ToArray</span>() <span class="k">with</span>
            | [|<span onmouseout="hideTip(event, 'fs179', 634)" onmouseover="showTip(event, 'fs179', 634)" class="i">op1</span>; <span onmouseout="hideTip(event, 'fs180', 635)" onmouseover="showTip(event, 'fs180', 635)" class="i">op2</span>|] <span class="k">-&gt;</span>
                <span class="k">match</span> <span onmouseout="hideTip(event, 'fs180', 636)" onmouseover="showTip(event, 'fs180', 636)" class="i">op2</span> <span class="k">with</span>
                | <span onmouseout="hideTip(event, 'fs19', 637)" onmouseover="showTip(event, 'fs19', 637)" class="i">OP_CHECKSIG</span> | <span onmouseout="hideTip(event, 'fs20', 638)" onmouseover="showTip(event, 'fs20', 638)" class="i">OP_CHECKSIGVERIFY</span> <span class="k">-&gt;</span> <span class="n">1</span> <span class="c">// single signature check counts as 1</span>
                | <span onmouseout="hideTip(event, 'fs21', 639)" onmouseover="showTip(event, 'fs21', 639)" class="i">OP_CHECKMULTISIG</span> | <span onmouseout="hideTip(event, 'fs22', 640)" onmouseover="showTip(event, 'fs22', 640)" class="i">OP_CHECKMULTISIGVERIFY</span> <span class="k">-&gt;</span> <span class="c">// if preceeded by OP_X, multi-sig counts as x, </span>
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs179', 641)" onmouseover="showTip(event, 'fs179', 641)" class="i">op1</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 642)" onmouseover="showTip(event, 'fs11', 642)" class="i">OP_1</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs179', 643)" onmouseover="showTip(event, 'fs179', 643)" class="i">op1</span> <span class="o">&lt;=</span> <span onmouseout="hideTip(event, 'fs12', 644)" onmouseover="showTip(event, 'fs12', 644)" class="i">OP_16</span> <span class="c">// otherwise counts as 20</span>
                    <span class="k">then</span> <span onmouseout="hideTip(event, 'fs58', 645)" onmouseover="showTip(event, 'fs58', 645)" class="i">int</span> (<span onmouseout="hideTip(event, 'fs179', 646)" onmouseover="showTip(event, 'fs179', 646)" class="i">op1</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs11', 647)" onmouseover="showTip(event, 'fs11', 647)" class="i">OP_1</span>)
                    <span class="k">else</span> <span class="n">20</span>
                | _ <span class="k">-&gt;</span> <span class="n">0</span>
            | _ <span class="k">-&gt;</span> <span class="n">0</span>
            ) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs176', 648)" onmouseover="showTip(event, 'fs176', 648)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs181', 649)" onmouseover="showTip(event, 'fs181', 649)" class="i">sum</span></pre>
</td>
</tr>
</table>

<h3>Single signature verification</h3>

<p>The signature hash type is the last byte of the signature and is always removed from it. Then any occurence
of the signature itself is removed from the pub script before the tx hash is calculated.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs182', 650)" onmouseover="showTip(event, 'fs182', 650)" class="i">checksigInner</span> <span onmouseout="hideTip(event, 'fs183', 651)" onmouseover="showTip(event, 'fs183', 651)" class="i">pubScript</span> <span onmouseout="hideTip(event, 'fs34', 652)" onmouseover="showTip(event, 'fs34', 652)" class="i">pub</span> (<span onmouseout="hideTip(event, 'fs35', 653)" onmouseover="showTip(event, 'fs35', 653)" class="i">signature</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 654)" onmouseover="showTip(event, 'fs27', 654)" class="i">byte</span>[]) <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs63', 655)" onmouseover="showTip(event, 'fs63', 655)" class="i">sigType</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs35', 656)" onmouseover="showTip(event, 'fs35', 656)" class="i">signature</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 657)" onmouseover="showTip(event, 'fs28', 657)" class="i">Length</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs35', 658)" onmouseover="showTip(event, 'fs35', 658)" class="i">signature</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs35', 659)" onmouseover="showTip(event, 'fs35', 659)" class="i">signature</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 660)" onmouseover="showTip(event, 'fs28', 660)" class="i">Length</span><span class="o">-</span><span class="n">1</span>] <span class="k">else</span> <span class="n">0uy</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 661)" onmouseover="showTip(event, 'fs33', 661)" class="i">txHash</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs102', 662)" onmouseover="showTip(event, 'fs102', 662)" class="i">getTxHash</span> <span onmouseout="hideTip(event, 'fs183', 663)" onmouseover="showTip(event, 'fs183', 663)" class="i">pubScript</span> <span onmouseout="hideTip(event, 'fs63', 664)" onmouseover="showTip(event, 'fs63', 664)" class="i">sigType</span>
        <span onmouseout="hideTip(event, 'fs32', 665)" onmouseover="showTip(event, 'fs32', 665)" class="i">ECDSACheck</span>(<span onmouseout="hideTip(event, 'fs33', 666)" onmouseover="showTip(event, 'fs33', 666)" class="i">txHash</span>, <span onmouseout="hideTip(event, 'fs34', 667)" onmouseover="showTip(event, 'fs34', 667)" class="i">pub</span>, <span onmouseout="hideTip(event, 'fs35', 668)" onmouseover="showTip(event, 'fs35', 668)" class="i">signature</span>)

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs184', 669)" onmouseover="showTip(event, 'fs184', 669)" class="i">checksig</span> <span onmouseout="hideTip(event, 'fs26', 670)" onmouseover="showTip(event, 'fs26', 670)" class="i">script</span> <span onmouseout="hideTip(event, 'fs34', 671)" onmouseover="showTip(event, 'fs34', 671)" class="i">pub</span> <span onmouseout="hideTip(event, 'fs35', 672)" onmouseover="showTip(event, 'fs35', 672)" class="i">signature</span> <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs183', 673)" onmouseover="showTip(event, 'fs183', 673)" class="i">pubScript</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs169', 674)" onmouseover="showTip(event, 'fs169', 674)" class="i">removeSignatures</span> <span onmouseout="hideTip(event, 'fs26', 675)" onmouseover="showTip(event, 'fs26', 675)" class="i">script</span> (<span class="k">new</span> <span onmouseout="hideTip(event, 'fs171', 676)" onmouseover="showTip(event, 'fs171', 676)" class="i">HashSet</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs27', 677)" onmouseover="showTip(event, 'fs27', 677)" class="i">byte</span>[]<span class="o">&gt;</span>([<span onmouseout="hideTip(event, 'fs35', 678)" onmouseover="showTip(event, 'fs35', 678)" class="i">signature</span>], <span class="i">hashCompare</span>))
        <span onmouseout="hideTip(event, 'fs182', 679)" onmouseover="showTip(event, 'fs182', 679)" class="i">checksigInner</span> <span onmouseout="hideTip(event, 'fs183', 680)" onmouseover="showTip(event, 'fs183', 680)" class="i">pubScript</span> <span onmouseout="hideTip(event, 'fs34', 681)" onmouseover="showTip(event, 'fs34', 681)" class="i">pub</span> <span onmouseout="hideTip(event, 'fs35', 682)" onmouseover="showTip(event, 'fs35', 682)" class="i">signature</span></pre>
</td>
</tr>
</table>

<h3>Multi signature verification</h3>

<p>In a multi sig, every pub key is checked against the signatures and then discarded. Eventually, all the
signatures must match a pub key. Because of this order of evaluation, signatures have to be provided in the same
order as the pub keys.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs185', 683)" onmouseover="showTip(event, 'fs185', 683)" class="i">checkmultisig</span> <span onmouseout="hideTip(event, 'fs26', 684)" onmouseover="showTip(event, 'fs26', 684)" class="i">script</span> (<span onmouseout="hideTip(event, 'fs186', 685)" onmouseover="showTip(event, 'fs186', 685)" class="i">pubs</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 686)" onmouseover="showTip(event, 'fs27', 686)" class="i">byte</span>[][]) (<span onmouseout="hideTip(event, 'fs187', 687)" onmouseover="showTip(event, 'fs187', 687)" class="i">sigs</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 688)" onmouseover="showTip(event, 'fs27', 688)" class="i">byte</span>[] <span onmouseout="hideTip(event, 'fs188', 689)" onmouseover="showTip(event, 'fs188', 689)" class="i">list</span>) <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs183', 690)" onmouseover="showTip(event, 'fs183', 690)" class="i">pubScript</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs169', 691)" onmouseover="showTip(event, 'fs169', 691)" class="i">removeSignatures</span> <span onmouseout="hideTip(event, 'fs26', 692)" onmouseover="showTip(event, 'fs26', 692)" class="i">script</span> (<span class="k">new</span> <span onmouseout="hideTip(event, 'fs171', 693)" onmouseover="showTip(event, 'fs171', 693)" class="i">HashSet</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs27', 694)" onmouseover="showTip(event, 'fs27', 694)" class="i">byte</span>[]<span class="o">&gt;</span>(<span onmouseout="hideTip(event, 'fs187', 695)" onmouseover="showTip(event, 'fs187', 695)" class="i">sigs</span>, <span class="i">hashCompare</span>))

        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs189', 696)" onmouseover="showTip(event, 'fs189', 696)" class="i">checkOneSig</span> (<span onmouseout="hideTip(event, 'fs190', 697)" onmouseover="showTip(event, 'fs190', 697)" class="i">pubs</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 698)" onmouseover="showTip(event, 'fs27', 698)" class="i">byte</span>[] <span onmouseout="hideTip(event, 'fs188', 699)" onmouseover="showTip(event, 'fs188', 699)" class="i">list</span>) (<span onmouseout="hideTip(event, 'fs35', 700)" onmouseover="showTip(event, 'fs35', 700)" class="i">signature</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 701)" onmouseover="showTip(event, 'fs27', 701)" class="i">byte</span>[]) <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs190', 702)" onmouseover="showTip(event, 'fs190', 702)" class="i">pubs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs37', 703)" onmouseover="showTip(event, 'fs37', 703)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs191', 704)" onmouseover="showTip(event, 'fs191', 704)" class="i">tryFindIndex</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs34', 705)" onmouseover="showTip(event, 'fs34', 705)" class="i">pub</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs182', 706)" onmouseover="showTip(event, 'fs182', 706)" class="i">checksigInner</span> <span onmouseout="hideTip(event, 'fs183', 707)" onmouseover="showTip(event, 'fs183', 707)" class="i">pubScript</span> <span onmouseout="hideTip(event, 'fs34', 708)" onmouseover="showTip(event, 'fs34', 708)" class="i">pub</span> <span onmouseout="hideTip(event, 'fs35', 709)" onmouseover="showTip(event, 'fs35', 709)" class="i">signature</span>)
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs7', 710)" onmouseover="showTip(event, 'fs7', 710)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs192', 711)" onmouseover="showTip(event, 'fs192', 711)" class="i">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs61', 712)" onmouseover="showTip(event, 'fs61', 712)" class="i">index</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs190', 713)" onmouseover="showTip(event, 'fs190', 713)" class="i">pubs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs37', 714)" onmouseover="showTip(event, 'fs37', 714)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs193', 715)" onmouseover="showTip(event, 'fs193', 715)" class="i">splitAt</span> <span onmouseout="hideTip(event, 'fs61', 716)" onmouseover="showTip(event, 'fs61', 716)" class="i">index</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs194', 717)" onmouseover="showTip(event, 'fs194', 717)" class="i">snd</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs37', 718)" onmouseover="showTip(event, 'fs37', 718)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs195', 719)" onmouseover="showTip(event, 'fs195', 719)" class="i">tail</span>)
                
        <span onmouseout="hideTip(event, 'fs187', 720)" onmouseover="showTip(event, 'fs187', 720)" class="i">sigs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs7', 721)" onmouseover="showTip(event, 'fs7', 721)" class="i">Option</span><span class="o">.</span><span class="i">foldM</span> <span onmouseout="hideTip(event, 'fs189', 722)" onmouseover="showTip(event, 'fs189', 722)" class="i">checkOneSig</span> (<span onmouseout="hideTip(event, 'fs186', 723)" onmouseover="showTip(event, 'fs186', 723)" class="i">pubs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs74', 724)" onmouseover="showTip(event, 'fs74', 724)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs196', 725)" onmouseover="showTip(event, 'fs196', 725)" class="i">toList</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs7', 726)" onmouseover="showTip(event, 'fs7', 726)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs197', 727)" onmouseover="showTip(event, 'fs197', 727)" class="i">isSome</span></pre>
</td>
</tr>
</table>

<h2>Evaluate a script</h2>

<p>It's the main eval loop using tail recursion. The <code>eval</code> function reads one byte from the program and decide
if it's data or instruction. If it's data, one or more bytes are then read. If it's instruction, it's always a single
byte. It's an important trick because when the code must be skipped because it is on the wrong side of a If/then/else, 
the function can quickly jump to the next code.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs198', 728)" onmouseover="showTip(event, 'fs198', 728)" class="i">eval</span> (<span onmouseout="hideTip(event, 'fs26', 729)" onmouseover="showTip(event, 'fs26', 729)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 730)" onmouseover="showTip(event, 'fs27', 730)" class="i">byte</span>[]) <span class="o">=</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs147', 731)" onmouseover="showTip(event, 'fs147', 731)" class="i">ms</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs68', 732)" onmouseover="showTip(event, 'fs68', 732)" class="i">MemoryStream</span>(<span onmouseout="hideTip(event, 'fs26', 733)" onmouseover="showTip(event, 'fs26', 733)" class="i">script</span>)
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs148', 734)" onmouseover="showTip(event, 'fs148', 734)" class="i">reader</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs149', 735)" onmouseover="showTip(event, 'fs149', 735)" class="i">BinaryReader</span>(<span onmouseout="hideTip(event, 'fs147', 736)" onmouseover="showTip(event, 'fs147', 736)" class="i">ms</span>)

        <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs199', 737)" onmouseover="showTip(event, 'fs199', 737)" class="i">innerEval</span>() <span class="o">=</span>
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs147', 738)" onmouseover="showTip(event, 'fs147', 738)" class="i">ms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs151', 739)" onmouseover="showTip(event, 'fs151', 739)" class="i">Position</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs147', 740)" onmouseover="showTip(event, 'fs147', 740)" class="i">ms</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs152', 741)" onmouseover="showTip(event, 'fs152', 741)" class="i">Length</span> <span class="k">then</span>
                <span class="k">let</span> <span onmouseout="hideTip(event, 'fs154', 742)" onmouseover="showTip(event, 'fs154', 742)" class="i">c</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 743)" onmouseover="showTip(event, 'fs58', 743)" class="i">int</span> (<span onmouseout="hideTip(event, 'fs148', 744)" onmouseover="showTip(event, 'fs148', 744)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 745)" onmouseover="showTip(event, 'fs153', 745)" class="i">ReadByte</span>())
                <span class="c">// logger.DebugF &quot;Stack size %d op = %x&quot; evalStack.Count c</span>
                <span class="k">if</span> <span onmouseout="hideTip(event, 'fs154', 746)" onmouseover="showTip(event, 'fs154', 746)" class="i">c</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span>
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs115', 747)" onmouseover="showTip(event, 'fs115', 747)" class="i">not</span> <span onmouseout="hideTip(event, 'fs106', 748)" onmouseover="showTip(event, 'fs106', 748)" class="i">skipping</span> <span class="k">then</span>
                        <span onmouseout="hideTip(event, 'fs103', 749)" onmouseover="showTip(event, 'fs103', 749)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 750)" onmouseover="showTip(event, 'fs117', 750)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs74', 751)" onmouseover="showTip(event, 'fs74', 751)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 752)" onmouseover="showTip(event, 'fs77', 752)" class="i">empty</span>)
                <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs154', 753)" onmouseover="showTip(event, 'fs154', 753)" class="i">c</span> <span class="o">=</span> <span class="n">79</span> <span class="k">then</span>
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs115', 754)" onmouseover="showTip(event, 'fs115', 754)" class="i">not</span> <span onmouseout="hideTip(event, 'fs106', 755)" onmouseover="showTip(event, 'fs106', 755)" class="i">skipping</span> <span class="k">then</span>
                        <span onmouseout="hideTip(event, 'fs103', 756)" onmouseover="showTip(event, 'fs103', 756)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 757)" onmouseover="showTip(event, 'fs117', 757)" class="i">Push</span>([| <span class="n">0x81uy</span> |])</pre>
</td>
</tr>
</table>

<h3>Push data</h3>

<p>There are different size of push data, 1, 2, or 4 bytes</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
                <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs154', 758)" onmouseover="showTip(event, 'fs154', 758)" class="i">c</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">1</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs154', 759)" onmouseover="showTip(event, 'fs154', 759)" class="i">c</span> <span class="o">&lt;=</span> <span class="n">78</span> <span class="k">then</span>
                    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs156', 760)" onmouseover="showTip(event, 'fs156', 760)" class="i">len</span> <span class="o">=</span> 
                        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs154', 761)" onmouseover="showTip(event, 'fs154', 761)" class="i">c</span> <span class="k">with</span>
                        | <span class="n">76</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 762)" onmouseover="showTip(event, 'fs58', 762)" class="i">int</span> (<span onmouseout="hideTip(event, 'fs148', 763)" onmouseover="showTip(event, 'fs148', 763)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 764)" onmouseover="showTip(event, 'fs153', 764)" class="i">ReadByte</span>())
                        | <span class="n">77</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 765)" onmouseover="showTip(event, 'fs58', 765)" class="i">int</span> (<span onmouseout="hideTip(event, 'fs148', 766)" onmouseover="showTip(event, 'fs148', 766)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs157', 767)" onmouseover="showTip(event, 'fs157', 767)" class="i">ReadInt16</span>())
                        | <span class="n">78</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs148', 768)" onmouseover="showTip(event, 'fs148', 768)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs158', 769)" onmouseover="showTip(event, 'fs158', 769)" class="i">ReadInt32</span>()
                        | <span onmouseout="hideTip(event, 'fs134', 770)" onmouseover="showTip(event, 'fs134', 770)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 771)" onmouseover="showTip(event, 'fs134', 771)" class="i">x</span>
                    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs83', 772)" onmouseover="showTip(event, 'fs83', 772)" class="i">data</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs148', 773)" onmouseover="showTip(event, 'fs148', 773)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs159', 774)" onmouseover="showTip(event, 'fs159', 774)" class="i">ReadBytes</span>(<span onmouseout="hideTip(event, 'fs156', 775)" onmouseover="showTip(event, 'fs156', 775)" class="i">len</span>)
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs115', 776)" onmouseover="showTip(event, 'fs115', 776)" class="i">not</span> <span onmouseout="hideTip(event, 'fs106', 777)" onmouseover="showTip(event, 'fs106', 777)" class="i">skipping</span> <span class="k">then</span>
                        <span onmouseout="hideTip(event, 'fs103', 778)" onmouseover="showTip(event, 'fs103', 778)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 779)" onmouseover="showTip(event, 'fs117', 779)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs83', 780)" onmouseover="showTip(event, 'fs83', 780)" class="i">data</span>)</pre>
</td>
</tr>
</table>

<h3>OP_1 etc</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
                <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs154', 781)" onmouseover="showTip(event, 'fs154', 781)" class="i">c</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">81</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs154', 782)" onmouseover="showTip(event, 'fs154', 782)" class="i">c</span> <span class="o">&lt;=</span> <span class="n">96</span> <span class="k">then</span>
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs115', 783)" onmouseover="showTip(event, 'fs115', 783)" class="i">not</span> <span onmouseout="hideTip(event, 'fs106', 784)" onmouseover="showTip(event, 'fs106', 784)" class="i">skipping</span> <span class="k">then</span>
                        <span onmouseout="hideTip(event, 'fs103', 785)" onmouseover="showTip(event, 'fs103', 785)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 786)" onmouseover="showTip(event, 'fs117', 786)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs85', 787)" onmouseover="showTip(event, 'fs85', 787)" class="i">intToBytes</span> (<span onmouseout="hideTip(event, 'fs154', 788)" onmouseover="showTip(event, 'fs154', 788)" class="i">c</span><span class="o">-</span><span class="n">80</span>))</pre>
</td>
</tr>
</table>

<h3>IF/THEN/ELSE</h3>

<p>Some special care must be given to if/then/else. They can nest so the 
logic must accomodate that. The parser keeps a state variable <code>skipping</code> which tells it whether instructions and push data
must be skipped or not. On a IF, the current value of <code>skipping</code> is pushed on a 'if' stack and if the parser is not currently
skipping, the top of the stack is read. In other words, the if statement is evaluated if it was not part of a dead-if branch, but
the push itself is always done in order for the parser to keep track of the if/endif nesting. Same thing happens on an else. <code>skipping</code>
is flipped only if the enclosing block isn't skipped too. The parser knows that by peeking at the top of the if-stack.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
                <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs154', 789)" onmouseover="showTip(event, 'fs154', 789)" class="i">c</span> <span class="o">=</span> <span class="n">99</span> <span class="o">||</span> <span onmouseout="hideTip(event, 'fs154', 790)" onmouseover="showTip(event, 'fs154', 790)" class="i">c</span> <span class="o">=</span> <span class="n">100</span> <span class="k">then</span>
                    <span onmouseout="hideTip(event, 'fs105', 791)" onmouseover="showTip(event, 'fs105', 791)" class="i">ifStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs200', 792)" onmouseover="showTip(event, 'fs200', 792)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs106', 793)" onmouseover="showTip(event, 'fs106', 793)" class="i">skipping</span>)
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs115', 794)" onmouseover="showTip(event, 'fs115', 794)" class="i">not</span> <span onmouseout="hideTip(event, 'fs106', 795)" onmouseover="showTip(event, 'fs106', 795)" class="i">skipping</span> <span class="k">then</span>
                        <span onmouseout="hideTip(event, 'fs106', 796)" onmouseover="showTip(event, 'fs106', 796)" class="i">skipping</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs115', 797)" onmouseover="showTip(event, 'fs115', 797)" class="i">not</span> (<span onmouseout="hideTip(event, 'fs112', 798)" onmouseover="showTip(event, 'fs112', 798)" class="i">popAsBool</span>())
                        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs154', 799)" onmouseover="showTip(event, 'fs154', 799)" class="i">c</span> <span class="o">=</span> <span class="n">100</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs106', 800)" onmouseover="showTip(event, 'fs106', 800)" class="i">skipping</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs115', 801)" onmouseover="showTip(event, 'fs115', 801)" class="i">not</span> <span onmouseout="hideTip(event, 'fs106', 802)" onmouseover="showTip(event, 'fs106', 802)" class="i">skipping</span>
                <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs154', 803)" onmouseover="showTip(event, 'fs154', 803)" class="i">c</span> <span class="o">=</span> <span class="n">103</span> <span class="k">then</span>
                    <span onmouseout="hideTip(event, 'fs108', 804)" onmouseover="showTip(event, 'fs108', 804)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs105', 805)" onmouseover="showTip(event, 'fs105', 805)" class="i">ifStack</span> <span class="n">1</span>
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs115', 806)" onmouseover="showTip(event, 'fs115', 806)" class="i">not</span> (<span onmouseout="hideTip(event, 'fs105', 807)" onmouseover="showTip(event, 'fs105', 807)" class="i">ifStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 808)" onmouseover="showTip(event, 'fs43', 808)" class="i">Peek</span>()) <span class="k">then</span> <span onmouseout="hideTip(event, 'fs106', 809)" onmouseover="showTip(event, 'fs106', 809)" class="i">skipping</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs115', 810)" onmouseover="showTip(event, 'fs115', 810)" class="i">not</span> <span onmouseout="hideTip(event, 'fs106', 811)" onmouseover="showTip(event, 'fs106', 811)" class="i">skipping</span>
                <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs154', 812)" onmouseover="showTip(event, 'fs154', 812)" class="i">c</span> <span class="o">=</span> <span class="n">104</span> <span class="k">then</span>
                    <span onmouseout="hideTip(event, 'fs108', 813)" onmouseover="showTip(event, 'fs108', 813)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs105', 814)" onmouseover="showTip(event, 'fs105', 814)" class="i">ifStack</span> <span class="n">1</span>
                    <span onmouseout="hideTip(event, 'fs106', 815)" onmouseover="showTip(event, 'fs106', 815)" class="i">skipping</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs105', 816)" onmouseover="showTip(event, 'fs105', 816)" class="i">ifStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 817)" onmouseover="showTip(event, 'fs113', 817)" class="i">Pop</span>()
                <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs154', 818)" onmouseover="showTip(event, 'fs154', 818)" class="i">c</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">176</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs154', 819)" onmouseover="showTip(event, 'fs154', 819)" class="i">c</span> <span class="o">&lt;=</span> <span class="n">185</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs80', 820)" onmouseover="showTip(event, 'fs80', 820)" class="i">ignore</span>()
                <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs115', 821)" onmouseover="showTip(event, 'fs115', 821)" class="i">not</span> <span onmouseout="hideTip(event, 'fs106', 822)" onmouseover="showTip(event, 'fs106', 822)" class="i">skipping</span> <span class="k">then</span></pre>
</td>
</tr>
</table>

<h3>Stack operators</h3>

<p>These do various permutations of the stack element and other simple stack manipulation. The parser also maintains a alt-stack but it
is cleared between the parts of the script evaluation.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
<span class="l">58: </span>
<span class="l">59: </span>
<span class="l">60: </span>
<span class="l">61: </span>
<span class="l">62: </span>
<span class="l">63: </span>
<span class="l">64: </span>
<span class="l">65: </span>
<span class="l">66: </span>
<span class="l">67: </span>
<span class="l">68: </span>
<span class="l">69: </span>
<span class="l">70: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
                    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs154', 823)" onmouseover="showTip(event, 'fs154', 823)" class="i">c</span> <span class="k">with</span>
                    | <span class="n">97</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs80', 824)" onmouseover="showTip(event, 'fs80', 824)" class="i">ignore</span>()
                    | <span class="n">105</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs114', 825)" onmouseover="showTip(event, 'fs114', 825)" class="i">verify</span>()
                    | <span class="n">106</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs116', 826)" onmouseover="showTip(event, 'fs116', 826)" class="i">fail</span>()
                    | <span class="n">107</span> <span class="k">-&gt;</span> 
                        <span onmouseout="hideTip(event, 'fs108', 827)" onmouseover="showTip(event, 'fs108', 827)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 828)" onmouseover="showTip(event, 'fs103', 828)" class="i">evalStack</span> <span class="n">1</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 829)" onmouseover="showTip(event, 'fs120', 829)" class="i">top</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 830)" onmouseover="showTip(event, 'fs103', 830)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 831)" onmouseover="showTip(event, 'fs113', 831)" class="i">Pop</span>()
                        <span onmouseout="hideTip(event, 'fs104', 832)" onmouseover="showTip(event, 'fs104', 832)" class="i">altStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 833)" onmouseover="showTip(event, 'fs117', 833)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs120', 834)" onmouseover="showTip(event, 'fs120', 834)" class="i">top</span>)
                    | <span class="n">108</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs108', 835)" onmouseover="showTip(event, 'fs108', 835)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs104', 836)" onmouseover="showTip(event, 'fs104', 836)" class="i">altStack</span> <span class="n">1</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 837)" onmouseover="showTip(event, 'fs120', 837)" class="i">top</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs104', 838)" onmouseover="showTip(event, 'fs104', 838)" class="i">altStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 839)" onmouseover="showTip(event, 'fs113', 839)" class="i">Pop</span>()
                        <span onmouseout="hideTip(event, 'fs103', 840)" onmouseover="showTip(event, 'fs103', 840)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 841)" onmouseover="showTip(event, 'fs117', 841)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs120', 842)" onmouseover="showTip(event, 'fs120', 842)" class="i">top</span>)
                    | <span class="n">109</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs108', 843)" onmouseover="showTip(event, 'fs108', 843)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 844)" onmouseover="showTip(event, 'fs103', 844)" class="i">evalStack</span> <span class="n">2</span>
                        <span onmouseout="hideTip(event, 'fs103', 845)" onmouseover="showTip(event, 'fs103', 845)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 846)" onmouseover="showTip(event, 'fs113', 846)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs80', 847)" onmouseover="showTip(event, 'fs80', 847)" class="i">ignore</span>
                        <span onmouseout="hideTip(event, 'fs103', 848)" onmouseover="showTip(event, 'fs103', 848)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 849)" onmouseover="showTip(event, 'fs113', 849)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs80', 850)" onmouseover="showTip(event, 'fs80', 850)" class="i">ignore</span>
                    | <span class="n">110</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs122', 851)" onmouseover="showTip(event, 'fs122', 851)" class="i">dup</span> <span class="n">2</span> <span class="n">0</span>
                    | <span class="n">111</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs122', 852)" onmouseover="showTip(event, 'fs122', 852)" class="i">dup</span> <span class="n">3</span> <span class="n">0</span>
                    | <span class="n">112</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs122', 853)" onmouseover="showTip(event, 'fs122', 853)" class="i">dup</span> <span class="n">2</span> <span class="n">2</span>
                    | <span class="n">113</span> <span class="k">-&gt;</span> 
                        <span onmouseout="hideTip(event, 'fs118', 854)" onmouseover="showTip(event, 'fs118', 854)" class="i">roll</span> <span class="n">5</span>
                        <span onmouseout="hideTip(event, 'fs118', 855)" onmouseover="showTip(event, 'fs118', 855)" class="i">roll</span> <span class="n">5</span>
                    | <span class="n">114</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs118', 856)" onmouseover="showTip(event, 'fs118', 856)" class="i">roll</span> <span class="n">3</span>
                        <span onmouseout="hideTip(event, 'fs118', 857)" onmouseover="showTip(event, 'fs118', 857)" class="i">roll</span> <span class="n">3</span>
                    | <span class="n">115</span> <span class="k">-&gt;</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs201', 858)" onmouseover="showTip(event, 'fs201', 858)" class="i">t</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 859)" onmouseover="showTip(event, 'fs103', 859)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 860)" onmouseover="showTip(event, 'fs43', 860)" class="i">Peek</span>()
                        <span onmouseout="hideTip(event, 'fs103', 861)" onmouseover="showTip(event, 'fs103', 861)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 862)" onmouseover="showTip(event, 'fs117', 862)" class="i">Push</span> <span onmouseout="hideTip(event, 'fs201', 863)" onmouseover="showTip(event, 'fs201', 863)" class="i">t</span>
                        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs112', 864)" onmouseover="showTip(event, 'fs112', 864)" class="i">popAsBool</span>() <span class="k">then</span> <span onmouseout="hideTip(event, 'fs103', 865)" onmouseover="showTip(event, 'fs103', 865)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 866)" onmouseover="showTip(event, 'fs117', 866)" class="i">Push</span> <span onmouseout="hideTip(event, 'fs201', 867)" onmouseover="showTip(event, 'fs201', 867)" class="i">t</span>
                    | <span class="n">116</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs103', 868)" onmouseover="showTip(event, 'fs103', 868)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 869)" onmouseover="showTip(event, 'fs117', 869)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs85', 870)" onmouseover="showTip(event, 'fs85', 870)" class="i">intToBytes</span> (<span onmouseout="hideTip(event, 'fs103', 871)" onmouseover="showTip(event, 'fs103', 871)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 872)" onmouseover="showTip(event, 'fs45', 872)" class="i">Count</span>))
                    | <span class="n">117</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs108', 873)" onmouseover="showTip(event, 'fs108', 873)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 874)" onmouseover="showTip(event, 'fs103', 874)" class="i">evalStack</span> <span class="n">1</span>
                        <span onmouseout="hideTip(event, 'fs103', 875)" onmouseover="showTip(event, 'fs103', 875)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 876)" onmouseover="showTip(event, 'fs113', 876)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs80', 877)" onmouseover="showTip(event, 'fs80', 877)" class="i">ignore</span>
                    | <span class="n">118</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs103', 878)" onmouseover="showTip(event, 'fs103', 878)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 879)" onmouseover="showTip(event, 'fs117', 879)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs103', 880)" onmouseover="showTip(event, 'fs103', 880)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 881)" onmouseover="showTip(event, 'fs43', 881)" class="i">Peek</span>())
                    | <span class="n">119</span> <span class="k">-&gt;</span> 
                        <span onmouseout="hideTip(event, 'fs108', 882)" onmouseover="showTip(event, 'fs108', 882)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 883)" onmouseover="showTip(event, 'fs103', 883)" class="i">evalStack</span> <span class="n">2</span>
                        <span onmouseout="hideTip(event, 'fs103', 884)" onmouseover="showTip(event, 'fs103', 884)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs44', 885)" onmouseover="showTip(event, 'fs44', 885)" class="i">RemoveAt</span>(<span onmouseout="hideTip(event, 'fs103', 886)" onmouseover="showTip(event, 'fs103', 886)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 887)" onmouseover="showTip(event, 'fs45', 887)" class="i">Count</span><span class="o">-</span><span class="n">2</span>)
                    | <span class="n">120</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs108', 888)" onmouseover="showTip(event, 'fs108', 888)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 889)" onmouseover="showTip(event, 'fs103', 889)" class="i">evalStack</span> <span class="n">2</span>
                        <span onmouseout="hideTip(event, 'fs103', 890)" onmouseover="showTip(event, 'fs103', 890)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 891)" onmouseover="showTip(event, 'fs117', 891)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs103', 892)" onmouseover="showTip(event, 'fs103', 892)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs121', 893)" onmouseover="showTip(event, 'fs121', 893)" class="i">Item</span>(<span onmouseout="hideTip(event, 'fs103', 894)" onmouseover="showTip(event, 'fs103', 894)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 895)" onmouseover="showTip(event, 'fs45', 895)" class="i">Count</span><span class="o">-</span><span class="n">2</span>))
                    | <span class="n">121</span> <span class="k">-&gt;</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs119', 896)" onmouseover="showTip(event, 'fs119', 896)" class="i">n</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 897)" onmouseover="showTip(event, 'fs58', 897)" class="i">int</span>(<span onmouseout="hideTip(event, 'fs95', 898)" onmouseover="showTip(event, 'fs95', 898)" class="i">bytesToInt</span>(<span onmouseout="hideTip(event, 'fs103', 899)" onmouseover="showTip(event, 'fs103', 899)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 900)" onmouseover="showTip(event, 'fs113', 900)" class="i">Pop</span>()))
                        <span onmouseout="hideTip(event, 'fs108', 901)" onmouseover="showTip(event, 'fs108', 901)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 902)" onmouseover="showTip(event, 'fs103', 902)" class="i">evalStack</span> (<span onmouseout="hideTip(event, 'fs119', 903)" onmouseover="showTip(event, 'fs119', 903)" class="i">n</span><span class="o">+</span><span class="n">1</span>)
                        <span onmouseout="hideTip(event, 'fs103', 904)" onmouseover="showTip(event, 'fs103', 904)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 905)" onmouseover="showTip(event, 'fs117', 905)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs103', 906)" onmouseover="showTip(event, 'fs103', 906)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs121', 907)" onmouseover="showTip(event, 'fs121', 907)" class="i">Item</span>(<span onmouseout="hideTip(event, 'fs103', 908)" onmouseover="showTip(event, 'fs103', 908)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 909)" onmouseover="showTip(event, 'fs45', 909)" class="i">Count</span><span class="o">-</span><span class="n">1</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs119', 910)" onmouseover="showTip(event, 'fs119', 910)" class="i">n</span>))
                    | <span class="n">122</span> <span class="k">-&gt;</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs119', 911)" onmouseover="showTip(event, 'fs119', 911)" class="i">n</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 912)" onmouseover="showTip(event, 'fs58', 912)" class="i">int</span>(<span onmouseout="hideTip(event, 'fs95', 913)" onmouseover="showTip(event, 'fs95', 913)" class="i">bytesToInt</span>(<span onmouseout="hideTip(event, 'fs103', 914)" onmouseover="showTip(event, 'fs103', 914)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 915)" onmouseover="showTip(event, 'fs113', 915)" class="i">Pop</span>()))
                        <span onmouseout="hideTip(event, 'fs118', 916)" onmouseover="showTip(event, 'fs118', 916)" class="i">roll</span> (<span onmouseout="hideTip(event, 'fs119', 917)" onmouseover="showTip(event, 'fs119', 917)" class="i">n</span><span class="o">+</span><span class="n">1</span>)
                    | <span class="n">123</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs118', 918)" onmouseover="showTip(event, 'fs118', 918)" class="i">roll</span> <span class="n">3</span>
                    | <span class="n">124</span> <span class="k">-&gt;</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs202', 919)" onmouseover="showTip(event, 'fs202', 919)" class="i">a</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 920)" onmouseover="showTip(event, 'fs103', 920)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 921)" onmouseover="showTip(event, 'fs113', 921)" class="i">Pop</span>()
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs96', 922)" onmouseover="showTip(event, 'fs96', 922)" class="i">b</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 923)" onmouseover="showTip(event, 'fs103', 923)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 924)" onmouseover="showTip(event, 'fs113', 924)" class="i">Pop</span>()
                        <span onmouseout="hideTip(event, 'fs103', 925)" onmouseover="showTip(event, 'fs103', 925)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 926)" onmouseover="showTip(event, 'fs117', 926)" class="i">Push</span> <span onmouseout="hideTip(event, 'fs202', 927)" onmouseover="showTip(event, 'fs202', 927)" class="i">a</span>
                        <span onmouseout="hideTip(event, 'fs103', 928)" onmouseover="showTip(event, 'fs103', 928)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 929)" onmouseover="showTip(event, 'fs117', 929)" class="i">Push</span> <span onmouseout="hideTip(event, 'fs96', 930)" onmouseover="showTip(event, 'fs96', 930)" class="i">b</span>
                    | <span class="n">125</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs108', 931)" onmouseover="showTip(event, 'fs108', 931)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 932)" onmouseover="showTip(event, 'fs103', 932)" class="i">evalStack</span> <span class="n">2</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 933)" onmouseover="showTip(event, 'fs120', 933)" class="i">top</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 934)" onmouseover="showTip(event, 'fs103', 934)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 935)" onmouseover="showTip(event, 'fs43', 935)" class="i">Peek</span>()
                        <span onmouseout="hideTip(event, 'fs103', 936)" onmouseover="showTip(event, 'fs103', 936)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs203', 937)" onmouseover="showTip(event, 'fs203', 937)" class="i">Insert</span>(<span onmouseout="hideTip(event, 'fs103', 938)" onmouseover="showTip(event, 'fs103', 938)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 939)" onmouseover="showTip(event, 'fs45', 939)" class="i">Count</span><span class="o">-</span><span class="n">2</span>, <span onmouseout="hideTip(event, 'fs120', 940)" onmouseover="showTip(event, 'fs120', 940)" class="i">top</span>)
                    | <span class="n">126</span> | <span class="n">127</span> | <span class="n">128</span> | <span class="n">129</span> | <span class="n">131</span> | <span class="n">132</span> | <span class="n">133</span> | <span class="n">134</span>
                    | <span class="n">141</span> | <span class="n">142</span> | <span class="n">149</span> | <span class="n">150</span> | <span class="n">151</span> | <span class="n">152</span> | <span class="n">153</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs116', 941)" onmouseover="showTip(event, 'fs116', 941)" class="i">fail</span>()
                    | <span class="n">130</span> <span class="k">-&gt;</span> 
                        <span onmouseout="hideTip(event, 'fs108', 942)" onmouseover="showTip(event, 'fs108', 942)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 943)" onmouseover="showTip(event, 'fs103', 943)" class="i">evalStack</span> <span class="n">1</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 944)" onmouseover="showTip(event, 'fs120', 944)" class="i">top</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 945)" onmouseover="showTip(event, 'fs103', 945)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 946)" onmouseover="showTip(event, 'fs43', 946)" class="i">Peek</span>()
                        <span onmouseout="hideTip(event, 'fs103', 947)" onmouseover="showTip(event, 'fs103', 947)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 948)" onmouseover="showTip(event, 'fs117', 948)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs85', 949)" onmouseover="showTip(event, 'fs85', 949)" class="i">intToBytes</span> <span onmouseout="hideTip(event, 'fs120', 950)" onmouseover="showTip(event, 'fs120', 950)" class="i">top</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 951)" onmouseover="showTip(event, 'fs28', 951)" class="i">Length</span>)
                    | <span class="n">135</span> | <span class="n">136</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs108', 952)" onmouseover="showTip(event, 'fs108', 952)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 953)" onmouseover="showTip(event, 'fs103', 953)" class="i">evalStack</span> <span class="n">2</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs202', 954)" onmouseover="showTip(event, 'fs202', 954)" class="i">a</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 955)" onmouseover="showTip(event, 'fs103', 955)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 956)" onmouseover="showTip(event, 'fs113', 956)" class="i">Pop</span>()
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs96', 957)" onmouseover="showTip(event, 'fs96', 957)" class="i">b</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 958)" onmouseover="showTip(event, 'fs103', 958)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 959)" onmouseover="showTip(event, 'fs113', 959)" class="i">Pop</span>()
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs204', 960)" onmouseover="showTip(event, 'fs204', 960)" class="i">eq</span> <span class="o">=</span> <span class="k">if</span> <span class="i">hashCompare</span><span class="o">.</span><span class="i">Equals</span>(<span onmouseout="hideTip(event, 'fs202', 961)" onmouseover="showTip(event, 'fs202', 961)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs96', 962)" onmouseover="showTip(event, 'fs96', 962)" class="i">b</span>) <span class="k">then</span> <span class="n">1</span> <span class="k">else</span> <span class="n">0</span>
                        <span onmouseout="hideTip(event, 'fs103', 963)" onmouseover="showTip(event, 'fs103', 963)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 964)" onmouseover="showTip(event, 'fs117', 964)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs85', 965)" onmouseover="showTip(event, 'fs85', 965)" class="i">intToBytes</span> <span onmouseout="hideTip(event, 'fs204', 966)" onmouseover="showTip(event, 'fs204', 966)" class="i">eq</span>)
                        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs154', 967)" onmouseover="showTip(event, 'fs154', 967)" class="i">c</span> <span class="o">=</span> <span class="n">136</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs114', 968)" onmouseover="showTip(event, 'fs114', 968)" class="i">verify</span>()</pre>
</td>
</tr>
</table>

<h3>Arithmetic operators</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
                    | <span class="n">139</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs124', 969)" onmouseover="showTip(event, 'fs124', 969)" class="i">unaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 970)" onmouseover="showTip(event, 'fs134', 970)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 971)" onmouseover="showTip(event, 'fs134', 971)" class="i">x</span><span class="o">+</span><span class="n">1</span>)
                    | <span class="n">140</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs124', 972)" onmouseover="showTip(event, 'fs124', 972)" class="i">unaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 973)" onmouseover="showTip(event, 'fs134', 973)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 974)" onmouseover="showTip(event, 'fs134', 974)" class="i">x</span><span class="o">-</span><span class="n">1</span>)
                    | <span class="n">143</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs124', 975)" onmouseover="showTip(event, 'fs124', 975)" class="i">unaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 976)" onmouseover="showTip(event, 'fs134', 976)" class="i">x</span> <span class="k">-&gt;</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs134', 977)" onmouseover="showTip(event, 'fs134', 977)" class="i">x</span>)
                    | <span class="n">144</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs124', 978)" onmouseover="showTip(event, 'fs124', 978)" class="i">unaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 979)" onmouseover="showTip(event, 'fs134', 979)" class="i">x</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs134', 980)" onmouseover="showTip(event, 'fs134', 980)" class="i">x</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs134', 981)" onmouseover="showTip(event, 'fs134', 981)" class="i">x</span> <span class="k">else</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs134', 982)" onmouseover="showTip(event, 'fs134', 982)" class="i">x</span>)
                    | <span class="n">145</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs124', 983)" onmouseover="showTip(event, 'fs124', 983)" class="i">unaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 984)" onmouseover="showTip(event, 'fs134', 984)" class="i">x</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs134', 985)" onmouseover="showTip(event, 'fs134', 985)" class="i">x</span> <span class="o">&lt;&gt;</span> <span class="n">0</span> <span class="k">then</span> <span class="n">0</span> <span class="k">else</span> <span class="n">1</span>)
                    | <span class="n">146</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs124', 986)" onmouseover="showTip(event, 'fs124', 986)" class="i">unaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 987)" onmouseover="showTip(event, 'fs134', 987)" class="i">x</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs134', 988)" onmouseover="showTip(event, 'fs134', 988)" class="i">x</span> <span class="o">&lt;&gt;</span> <span class="n">0</span> <span class="k">then</span> <span class="n">1</span> <span class="k">else</span> <span class="n">0</span>)
                    | <span class="n">147</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs127', 989)" onmouseover="showTip(event, 'fs127', 989)" class="i">binaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 990)" onmouseover="showTip(event, 'fs134', 990)" class="i">x</span> <span onmouseout="hideTip(event, 'fs205', 991)" onmouseover="showTip(event, 'fs205', 991)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 992)" onmouseover="showTip(event, 'fs134', 992)" class="i">x</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs205', 993)" onmouseover="showTip(event, 'fs205', 993)" class="i">y</span>)
                    | <span class="n">148</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs127', 994)" onmouseover="showTip(event, 'fs127', 994)" class="i">binaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 995)" onmouseover="showTip(event, 'fs134', 995)" class="i">x</span> <span onmouseout="hideTip(event, 'fs205', 996)" onmouseover="showTip(event, 'fs205', 996)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 997)" onmouseover="showTip(event, 'fs134', 997)" class="i">x</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs205', 998)" onmouseover="showTip(event, 'fs205', 998)" class="i">y</span>)</pre>
</td>
</tr>
</table>

<h3>Logical operators</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
                    | <span class="n">154</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs131', 999)" onmouseover="showTip(event, 'fs131', 999)" class="i">logicalOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs136', 1000)" onmouseover="showTip(event, 'fs136', 1000)" class="i">x</span> <span onmouseout="hideTip(event, 'fs206', 1001)" onmouseover="showTip(event, 'fs206', 1001)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs136', 1002)" onmouseover="showTip(event, 'fs136', 1002)" class="i">x</span><span class="o">&amp;&amp;</span><span onmouseout="hideTip(event, 'fs206', 1003)" onmouseover="showTip(event, 'fs206', 1003)" class="i">y</span>)
                    | <span class="n">155</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs131', 1004)" onmouseover="showTip(event, 'fs131', 1004)" class="i">logicalOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs136', 1005)" onmouseover="showTip(event, 'fs136', 1005)" class="i">x</span> <span onmouseout="hideTip(event, 'fs206', 1006)" onmouseover="showTip(event, 'fs206', 1006)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs136', 1007)" onmouseover="showTip(event, 'fs136', 1007)" class="i">x</span><span class="o">||</span><span onmouseout="hideTip(event, 'fs206', 1008)" onmouseover="showTip(event, 'fs206', 1008)" class="i">y</span>)
                    | <span class="n">156</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs131', 1009)" onmouseover="showTip(event, 'fs131', 1009)" class="i">logicalOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs136', 1010)" onmouseover="showTip(event, 'fs136', 1010)" class="i">x</span> <span onmouseout="hideTip(event, 'fs206', 1011)" onmouseover="showTip(event, 'fs206', 1011)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs136', 1012)" onmouseover="showTip(event, 'fs136', 1012)" class="i">x</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs206', 1013)" onmouseover="showTip(event, 'fs206', 1013)" class="i">y</span>)
                    | <span class="n">157</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs131', 1014)" onmouseover="showTip(event, 'fs131', 1014)" class="i">logicalOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs136', 1015)" onmouseover="showTip(event, 'fs136', 1015)" class="i">x</span> <span onmouseout="hideTip(event, 'fs206', 1016)" onmouseover="showTip(event, 'fs206', 1016)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs136', 1017)" onmouseover="showTip(event, 'fs136', 1017)" class="i">x</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs206', 1018)" onmouseover="showTip(event, 'fs206', 1018)" class="i">y</span>)
                        <span onmouseout="hideTip(event, 'fs114', 1019)" onmouseover="showTip(event, 'fs114', 1019)" class="i">verify</span>()
                    | <span class="n">158</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs137', 1020)" onmouseover="showTip(event, 'fs137', 1020)" class="i">binaryBoolOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 1021)" onmouseover="showTip(event, 'fs134', 1021)" class="i">x</span> <span onmouseout="hideTip(event, 'fs205', 1022)" onmouseover="showTip(event, 'fs205', 1022)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 1023)" onmouseover="showTip(event, 'fs134', 1023)" class="i">x</span><span class="o">&lt;&gt;</span><span onmouseout="hideTip(event, 'fs205', 1024)" onmouseover="showTip(event, 'fs205', 1024)" class="i">y</span>)
                    | <span class="n">159</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs137', 1025)" onmouseover="showTip(event, 'fs137', 1025)" class="i">binaryBoolOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 1026)" onmouseover="showTip(event, 'fs134', 1026)" class="i">x</span> <span onmouseout="hideTip(event, 'fs205', 1027)" onmouseover="showTip(event, 'fs205', 1027)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 1028)" onmouseover="showTip(event, 'fs134', 1028)" class="i">x</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs205', 1029)" onmouseover="showTip(event, 'fs205', 1029)" class="i">y</span>)
                    | <span class="n">160</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs137', 1030)" onmouseover="showTip(event, 'fs137', 1030)" class="i">binaryBoolOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 1031)" onmouseover="showTip(event, 'fs134', 1031)" class="i">x</span> <span onmouseout="hideTip(event, 'fs205', 1032)" onmouseover="showTip(event, 'fs205', 1032)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 1033)" onmouseover="showTip(event, 'fs134', 1033)" class="i">x</span><span class="o">&gt;</span><span onmouseout="hideTip(event, 'fs205', 1034)" onmouseover="showTip(event, 'fs205', 1034)" class="i">y</span>)
                    | <span class="n">161</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs137', 1035)" onmouseover="showTip(event, 'fs137', 1035)" class="i">binaryBoolOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 1036)" onmouseover="showTip(event, 'fs134', 1036)" class="i">x</span> <span onmouseout="hideTip(event, 'fs205', 1037)" onmouseover="showTip(event, 'fs205', 1037)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 1038)" onmouseover="showTip(event, 'fs134', 1038)" class="i">x</span><span class="o">&lt;=</span><span onmouseout="hideTip(event, 'fs205', 1039)" onmouseover="showTip(event, 'fs205', 1039)" class="i">y</span>)
                    | <span class="n">162</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs137', 1040)" onmouseover="showTip(event, 'fs137', 1040)" class="i">binaryBoolOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 1041)" onmouseover="showTip(event, 'fs134', 1041)" class="i">x</span> <span onmouseout="hideTip(event, 'fs205', 1042)" onmouseover="showTip(event, 'fs205', 1042)" class="i">y</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 1043)" onmouseover="showTip(event, 'fs134', 1043)" class="i">x</span><span class="o">&gt;</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs205', 1044)" onmouseover="showTip(event, 'fs205', 1044)" class="i">y</span>)
                    | <span class="n">163</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs127', 1045)" onmouseover="showTip(event, 'fs127', 1045)" class="i">binaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 1046)" onmouseover="showTip(event, 'fs134', 1046)" class="i">x</span> <span onmouseout="hideTip(event, 'fs205', 1047)" onmouseover="showTip(event, 'fs205', 1047)" class="i">y</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs134', 1048)" onmouseover="showTip(event, 'fs134', 1048)" class="i">x</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs205', 1049)" onmouseover="showTip(event, 'fs205', 1049)" class="i">y</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs134', 1050)" onmouseover="showTip(event, 'fs134', 1050)" class="i">x</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs205', 1051)" onmouseover="showTip(event, 'fs205', 1051)" class="i">y</span>)
                    | <span class="n">164</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs127', 1052)" onmouseover="showTip(event, 'fs127', 1052)" class="i">binaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 1053)" onmouseover="showTip(event, 'fs134', 1053)" class="i">x</span> <span onmouseout="hideTip(event, 'fs205', 1054)" onmouseover="showTip(event, 'fs205', 1054)" class="i">y</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs134', 1055)" onmouseover="showTip(event, 'fs134', 1055)" class="i">x</span><span class="o">&gt;</span><span onmouseout="hideTip(event, 'fs205', 1056)" onmouseover="showTip(event, 'fs205', 1056)" class="i">y</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs134', 1057)" onmouseover="showTip(event, 'fs134', 1057)" class="i">x</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs205', 1058)" onmouseover="showTip(event, 'fs205', 1058)" class="i">y</span>)
                    | <span class="n">165</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs139', 1059)" onmouseover="showTip(event, 'fs139', 1059)" class="i">tertiaryOp</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs134', 1060)" onmouseover="showTip(event, 'fs134', 1060)" class="i">x</span> <span onmouseout="hideTip(event, 'fs207', 1061)" onmouseover="showTip(event, 'fs207', 1061)" class="i">a</span> <span onmouseout="hideTip(event, 'fs208', 1062)" onmouseover="showTip(event, 'fs208', 1062)" class="i">b</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs134', 1063)" onmouseover="showTip(event, 'fs134', 1063)" class="i">x</span><span class="o">&gt;</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs207', 1064)" onmouseover="showTip(event, 'fs207', 1064)" class="i">a</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs134', 1065)" onmouseover="showTip(event, 'fs134', 1065)" class="i">x</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs208', 1066)" onmouseover="showTip(event, 'fs208', 1066)" class="i">b</span> <span class="k">then</span> <span class="n">1</span> <span class="k">else</span> <span class="n">0</span>)</pre>
</td>
</tr>
</table>

<h3>Hashing operators</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
                    | <span class="n">166</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs142', 1067)" onmouseover="showTip(event, 'fs142', 1067)" class="i">hashOp</span>(<span class="i">ripe160</span>)
                    | <span class="n">167</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs142', 1068)" onmouseover="showTip(event, 'fs142', 1068)" class="i">hashOp</span>(<span class="i">sha1</span>)
                    | <span class="n">168</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs142', 1069)" onmouseover="showTip(event, 'fs142', 1069)" class="i">hashOp</span>(<span class="i">sha256</span>)
                    | <span class="n">169</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs142', 1070)" onmouseover="showTip(event, 'fs142', 1070)" class="i">hashOp</span>(<span class="i">hash160</span>)
                    | <span class="n">170</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs142', 1071)" onmouseover="showTip(event, 'fs142', 1071)" class="i">hashOp</span>(<span class="i">dsha</span>)
                    | <span class="n">171</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs107', 1072)" onmouseover="showTip(event, 'fs107', 1072)" class="i">codeSep</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs58', 1073)" onmouseover="showTip(event, 'fs58', 1073)" class="i">int</span>(<span onmouseout="hideTip(event, 'fs148', 1074)" onmouseover="showTip(event, 'fs148', 1074)" class="i">reader</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs209', 1075)" onmouseover="showTip(event, 'fs209', 1075)" class="i">BaseStream</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs210', 1076)" onmouseover="showTip(event, 'fs210', 1076)" class="i">Position</span>)</pre>
</td>
</tr>
</table>

<h3>Signature verification</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
                    | <span class="n">172</span> | <span class="n">173</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs108', 1077)" onmouseover="showTip(event, 'fs108', 1077)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 1078)" onmouseover="showTip(event, 'fs103', 1078)" class="i">evalStack</span> <span class="n">2</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 1079)" onmouseover="showTip(event, 'fs34', 1079)" class="i">pub</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 1080)" onmouseover="showTip(event, 'fs103', 1080)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 1081)" onmouseover="showTip(event, 'fs113', 1081)" class="i">Pop</span>()
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 1082)" onmouseover="showTip(event, 'fs35', 1082)" class="i">signature</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 1083)" onmouseover="showTip(event, 'fs103', 1083)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 1084)" onmouseover="showTip(event, 'fs113', 1084)" class="i">Pop</span>()
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs211', 1085)" onmouseover="showTip(event, 'fs211', 1085)" class="i">check</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs184', 1086)" onmouseover="showTip(event, 'fs184', 1086)" class="i">checksig</span> <span onmouseout="hideTip(event, 'fs26', 1087)" onmouseover="showTip(event, 'fs26', 1087)" class="i">script</span> <span onmouseout="hideTip(event, 'fs34', 1088)" onmouseover="showTip(event, 'fs34', 1088)" class="i">pub</span> <span onmouseout="hideTip(event, 'fs35', 1089)" onmouseover="showTip(event, 'fs35', 1089)" class="i">signature</span>
                        <span onmouseout="hideTip(event, 'fs103', 1090)" onmouseover="showTip(event, 'fs103', 1090)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 1091)" onmouseover="showTip(event, 'fs117', 1091)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs85', 1092)" onmouseover="showTip(event, 'fs85', 1092)" class="i">intToBytes</span>(<span class="k">if</span> <span onmouseout="hideTip(event, 'fs211', 1093)" onmouseover="showTip(event, 'fs211', 1093)" class="i">check</span> <span class="k">then</span> <span class="n">1</span> <span class="k">else</span> <span class="n">0</span>))
                        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs154', 1094)" onmouseover="showTip(event, 'fs154', 1094)" class="i">c</span> <span class="o">=</span> <span class="n">173</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs114', 1095)" onmouseover="showTip(event, 'fs114', 1095)" class="i">verify</span>()
                    | <span class="n">174</span> | <span class="n">175</span> <span class="k">-&gt;</span>
                        <span onmouseout="hideTip(event, 'fs108', 1096)" onmouseover="showTip(event, 'fs108', 1096)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 1097)" onmouseover="showTip(event, 'fs103', 1097)" class="i">evalStack</span> <span class="n">1</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs212', 1098)" onmouseover="showTip(event, 'fs212', 1098)" class="i">nPubs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 1099)" onmouseover="showTip(event, 'fs58', 1099)" class="i">int</span>(<span onmouseout="hideTip(event, 'fs95', 1100)" onmouseover="showTip(event, 'fs95', 1100)" class="i">bytesToInt</span>(<span onmouseout="hideTip(event, 'fs103', 1101)" onmouseover="showTip(event, 'fs103', 1101)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 1102)" onmouseover="showTip(event, 'fs113', 1102)" class="i">Pop</span>()))
                        <span onmouseout="hideTip(event, 'fs108', 1103)" onmouseover="showTip(event, 'fs108', 1103)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 1104)" onmouseover="showTip(event, 'fs103', 1104)" class="i">evalStack</span> <span onmouseout="hideTip(event, 'fs212', 1105)" onmouseover="showTip(event, 'fs212', 1105)" class="i">nPubs</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs186', 1106)" onmouseover="showTip(event, 'fs186', 1106)" class="i">pubs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs213', 1107)" onmouseover="showTip(event, 'fs213', 1107)" class="i">seq</span> { <span class="k">for</span> _ <span class="k">in</span> <span class="n">1..</span><span onmouseout="hideTip(event, 'fs212', 1108)" onmouseover="showTip(event, 'fs212', 1108)" class="i">nPubs</span> <span class="k">do</span> <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs103', 1109)" onmouseover="showTip(event, 'fs103', 1109)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 1110)" onmouseover="showTip(event, 'fs113', 1110)" class="i">Pop</span>() } <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs176', 1111)" onmouseover="showTip(event, 'fs176', 1111)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs214', 1112)" onmouseover="showTip(event, 'fs214', 1112)" class="i">toArray</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs215', 1113)" onmouseover="showTip(event, 'fs215', 1113)" class="i">nSigs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 1114)" onmouseover="showTip(event, 'fs58', 1114)" class="i">int</span>(<span onmouseout="hideTip(event, 'fs95', 1115)" onmouseover="showTip(event, 'fs95', 1115)" class="i">bytesToInt</span>(<span onmouseout="hideTip(event, 'fs103', 1116)" onmouseover="showTip(event, 'fs103', 1116)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 1117)" onmouseover="showTip(event, 'fs113', 1117)" class="i">Pop</span>()))
                        <span onmouseout="hideTip(event, 'fs108', 1118)" onmouseover="showTip(event, 'fs108', 1118)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 1119)" onmouseover="showTip(event, 'fs103', 1119)" class="i">evalStack</span> <span onmouseout="hideTip(event, 'fs215', 1120)" onmouseover="showTip(event, 'fs215', 1120)" class="i">nSigs</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs187', 1121)" onmouseover="showTip(event, 'fs187', 1121)" class="i">sigs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs213', 1122)" onmouseover="showTip(event, 'fs213', 1122)" class="i">seq</span> { <span class="k">for</span> _ <span class="k">in</span> <span class="n">1..</span><span onmouseout="hideTip(event, 'fs215', 1123)" onmouseover="showTip(event, 'fs215', 1123)" class="i">nSigs</span> <span class="k">do</span> <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs103', 1124)" onmouseover="showTip(event, 'fs103', 1124)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 1125)" onmouseover="showTip(event, 'fs113', 1125)" class="i">Pop</span>() } <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs176', 1126)" onmouseover="showTip(event, 'fs176', 1126)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs216', 1127)" onmouseover="showTip(event, 'fs216', 1127)" class="i">toList</span>
                        <span onmouseout="hideTip(event, 'fs103', 1128)" onmouseover="showTip(event, 'fs103', 1128)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 1129)" onmouseover="showTip(event, 'fs113', 1129)" class="i">Pop</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs80', 1130)" onmouseover="showTip(event, 'fs80', 1130)" class="i">ignore</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs211', 1131)" onmouseover="showTip(event, 'fs211', 1131)" class="i">check</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs185', 1132)" onmouseover="showTip(event, 'fs185', 1132)" class="i">checkmultisig</span> <span onmouseout="hideTip(event, 'fs26', 1133)" onmouseover="showTip(event, 'fs26', 1133)" class="i">script</span> <span onmouseout="hideTip(event, 'fs186', 1134)" onmouseover="showTip(event, 'fs186', 1134)" class="i">pubs</span> <span onmouseout="hideTip(event, 'fs187', 1135)" onmouseover="showTip(event, 'fs187', 1135)" class="i">sigs</span>
                        <span onmouseout="hideTip(event, 'fs103', 1136)" onmouseover="showTip(event, 'fs103', 1136)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 1137)" onmouseover="showTip(event, 'fs117', 1137)" class="i">Push</span>(<span onmouseout="hideTip(event, 'fs85', 1138)" onmouseover="showTip(event, 'fs85', 1138)" class="i">intToBytes</span>(<span class="k">if</span> <span onmouseout="hideTip(event, 'fs211', 1139)" onmouseover="showTip(event, 'fs211', 1139)" class="i">check</span> <span class="k">then</span> <span class="n">1</span> <span class="k">else</span> <span class="n">0</span>))
                        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs154', 1140)" onmouseover="showTip(event, 'fs154', 1140)" class="i">c</span> <span class="o">=</span> <span class="n">175</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs114', 1141)" onmouseover="showTip(event, 'fs114', 1141)" class="i">verify</span>()
                    | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs116', 1142)" onmouseover="showTip(event, 'fs116', 1142)" class="i">fail</span>()

                <span onmouseout="hideTip(event, 'fs199', 1143)" onmouseover="showTip(event, 'fs199', 1143)" class="i">innerEval</span>()

        <span onmouseout="hideTip(event, 'fs199', 1144)" onmouseover="showTip(event, 'fs199', 1144)" class="i">innerEval</span>()</pre>
</td>
</tr>
</table>

<h2>P2SH special case</h2>

<p>After the P2SH script is evaluated normally, the stack is cleared. The signature script is then reevaluated
and the last stack element poped from it. It becomes the new script to evaluate successfully.</p>

<p>TODO: Enforce strict BIP16 rules: No other opcode other than push data and redeem script limit</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs217', 1145)" onmouseover="showTip(event, 'fs217', 1145)" class="i">evalP2SH</span> (<span onmouseout="hideTip(event, 'fs26', 1146)" onmouseover="showTip(event, 'fs26', 1146)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 1147)" onmouseover="showTip(event, 'fs27', 1147)" class="i">byte</span>[]) <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs103', 1148)" onmouseover="showTip(event, 'fs103', 1148)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs218', 1149)" onmouseover="showTip(event, 'fs218', 1149)" class="i">Clear</span>()
        <span onmouseout="hideTip(event, 'fs198', 1150)" onmouseover="showTip(event, 'fs198', 1150)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs26', 1151)" onmouseover="showTip(event, 'fs26', 1151)" class="i">script</span>
        <span onmouseout="hideTip(event, 'fs108', 1152)" onmouseover="showTip(event, 'fs108', 1152)" class="i">checkDepth</span> <span onmouseout="hideTip(event, 'fs103', 1153)" onmouseover="showTip(event, 'fs103', 1153)" class="i">evalStack</span> <span class="n">1</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs219', 1154)" onmouseover="showTip(event, 'fs219', 1154)" class="i">redeemScript</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs103', 1155)" onmouseover="showTip(event, 'fs103', 1155)" class="i">evalStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 1156)" onmouseover="showTip(event, 'fs113', 1156)" class="i">Pop</span>()
        <span onmouseout="hideTip(event, 'fs198', 1157)" onmouseover="showTip(event, 'fs198', 1157)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs219', 1158)" onmouseover="showTip(event, 'fs219', 1158)" class="i">redeemScript</span>
        <span onmouseout="hideTip(event, 'fs112', 1159)" onmouseover="showTip(event, 'fs112', 1159)" class="i">popAsBool</span>()

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs220', 1160)" onmouseover="showTip(event, 'fs220', 1160)" class="i">redeemScript</span> (<span onmouseout="hideTip(event, 'fs26', 1161)" onmouseover="showTip(event, 'fs26', 1161)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 1162)" onmouseover="showTip(event, 'fs27', 1162)" class="i">byte</span>[]) <span class="o">=</span>
        <span class="k">let</span> (_, _, <span onmouseout="hideTip(event, 'fs221', 1163)" onmouseover="showTip(event, 'fs221', 1163)" class="i">data</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 1164)" onmouseover="showTip(event, 'fs144', 1164)" class="i">removeData</span> <span onmouseout="hideTip(event, 'fs26', 1165)" onmouseover="showTip(event, 'fs26', 1165)" class="i">script</span> (<span class="k">fun</span> _ <span class="k">-&gt;</span> <span class="k">true</span>)
        <span onmouseout="hideTip(event, 'fs221', 1166)" onmouseover="showTip(event, 'fs221', 1166)" class="i">data</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs74', 1167)" onmouseover="showTip(event, 'fs74', 1167)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs222', 1168)" onmouseover="showTip(event, 'fs222', 1168)" class="i">last</span>

    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs223', 1169)" onmouseover="showTip(event, 'fs223', 1169)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs224', 1170)" onmouseover="showTip(event, 'fs224', 1170)" class="i">Verify</span>(<span onmouseout="hideTip(event, 'fs225', 1171)" onmouseover="showTip(event, 'fs225', 1171)" class="i">inScript</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 1172)" onmouseover="showTip(event, 'fs27', 1172)" class="i">byte</span>[], <span onmouseout="hideTip(event, 'fs226', 1173)" onmouseover="showTip(event, 'fs226', 1173)" class="i">outScript</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 1174)" onmouseover="showTip(event, 'fs27', 1174)" class="i">byte</span>[]) <span class="o">=</span> 
        <span class="k">try</span>
            <span onmouseout="hideTip(event, 'fs198', 1175)" onmouseover="showTip(event, 'fs198', 1175)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs225', 1176)" onmouseover="showTip(event, 'fs225', 1176)" class="i">inScript</span>
            <span onmouseout="hideTip(event, 'fs104', 1177)" onmouseover="showTip(event, 'fs104', 1177)" class="i">altStack</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs218', 1178)" onmouseover="showTip(event, 'fs218', 1178)" class="i">Clear</span>() <span class="c">// bitcoin core does that</span>
            <span onmouseout="hideTip(event, 'fs198', 1179)" onmouseover="showTip(event, 'fs198', 1179)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs226', 1180)" onmouseover="showTip(event, 'fs226', 1180)" class="i">outScript</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs227', 1181)" onmouseover="showTip(event, 'fs227', 1181)" class="i">res</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs112', 1182)" onmouseover="showTip(event, 'fs112', 1182)" class="i">popAsBool</span>()
            <span onmouseout="hideTip(event, 'fs227', 1183)" onmouseover="showTip(event, 'fs227', 1183)" class="i">res</span> <span class="o">&amp;&amp;</span> (<span onmouseout="hideTip(event, 'fs115', 1184)" onmouseover="showTip(event, 'fs115', 1184)" class="i">not</span> (<span onmouseout="hideTip(event, 'fs31', 1185)" onmouseover="showTip(event, 'fs31', 1185)" class="i">isP2SH</span> <span onmouseout="hideTip(event, 'fs226', 1186)" onmouseover="showTip(event, 'fs226', 1186)" class="i">outScript</span>) <span class="o">||</span> <span onmouseout="hideTip(event, 'fs217', 1187)" onmouseover="showTip(event, 'fs217', 1187)" class="i">evalP2SH</span> <span onmouseout="hideTip(event, 'fs225', 1188)" onmouseover="showTip(event, 'fs225', 1188)" class="i">inScript</span>)
        <span class="k">with</span>
        | <span class="o">:?</span> <span class="i">ValidationException</span> <span class="k">-&gt;</span> <span class="k">false</span>

    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs223', 1189)" onmouseover="showTip(event, 'fs223', 1189)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs228', 1190)" onmouseover="showTip(event, 'fs228', 1190)" class="i">CheckSigCount</span> (<span onmouseout="hideTip(event, 'fs26', 1191)" onmouseover="showTip(event, 'fs26', 1191)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 1192)" onmouseover="showTip(event, 'fs27', 1192)" class="i">byte</span>[]) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs174', 1193)" onmouseover="showTip(event, 'fs174', 1193)" class="i">scriptCheckSigCount</span> <span onmouseout="hideTip(event, 'fs26', 1194)" onmouseover="showTip(event, 'fs26', 1194)" class="i">script</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs223', 1195)" onmouseover="showTip(event, 'fs223', 1195)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs229', 1196)" onmouseover="showTip(event, 'fs229', 1196)" class="i">RedeemScript</span> (<span onmouseout="hideTip(event, 'fs26', 1197)" onmouseover="showTip(event, 'fs26', 1197)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 1198)" onmouseover="showTip(event, 'fs27', 1198)" class="i">byte</span>[]) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs220', 1199)" onmouseover="showTip(event, 'fs220', 1199)" class="i">redeemScript</span> <span onmouseout="hideTip(event, 'fs26', 1200)" onmouseover="showTip(event, 'fs26', 1200)" class="i">script</span>
    <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs230', 1201)" onmouseover="showTip(event, 'fs230', 1201)" class="i">IsP2SH</span> (<span onmouseout="hideTip(event, 'fs26', 1202)" onmouseover="showTip(event, 'fs26', 1202)" class="i">script</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs27', 1203)" onmouseover="showTip(event, 'fs27', 1203)" class="i">byte</span>[]) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs31', 1204)" onmouseover="showTip(event, 'fs31', 1204)" class="i">isP2SH</span> <span onmouseout="hideTip(event, 'fs26', 1205)" onmouseover="showTip(event, 'fs26', 1205)" class="i">script</span></pre>
</td>
</tr>
</table>

          <div class="tip" id="fs1">module Script</div>
<div class="tip" id="fs2">namespace System</div>
<div class="tip" id="fs3">namespace System.Collections</div>
<div class="tip" id="fs4">namespace System.Collections.Generic</div>
<div class="tip" id="fs5">namespace System.Linq</div>
<div class="tip" id="fs6">namespace System.IO</div>
<div class="tip" id="fs7">module Option<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs8">val secp256k1Curve : obj<br /><br />Full name: Script.secp256k1Curve</div>
<div class="tip" id="fs9">val ecDomain : obj<br /><br />Full name: Script.ecDomain</div>
<div class="tip" id="fs10">val OP_DUP : byte<br /><br />Full name: Script.OP_DUP</div>
<div class="tip" id="fs11">val OP_1 : byte<br /><br />Full name: Script.OP_1</div>
<div class="tip" id="fs12">val OP_16 : byte<br /><br />Full name: Script.OP_16</div>
<div class="tip" id="fs13">val OP_HASH160 : byte<br /><br />Full name: Script.OP_HASH160</div>
<div class="tip" id="fs14">val OP_DATA_20 : byte<br /><br />Full name: Script.OP_DATA_20</div>
<div class="tip" id="fs15">val OP_DATA_32 : byte<br /><br />Full name: Script.OP_DATA_32</div>
<div class="tip" id="fs16">val OP_EQUAL : byte<br /><br />Full name: Script.OP_EQUAL</div>
<div class="tip" id="fs17">val OP_EQUALVERIFY : byte<br /><br />Full name: Script.OP_EQUALVERIFY</div>
<div class="tip" id="fs18">Multiple items<br />type LiteralAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; LiteralAttribute<br /><br />Full name: Microsoft.FSharp.Core.LiteralAttribute<br /><br />--------------------<br />new : unit -&gt; LiteralAttribute</div>
<div class="tip" id="fs19">val OP_CHECKSIG : byte<br /><br />Full name: Script.OP_CHECKSIG</div>
<div class="tip" id="fs20">val OP_CHECKSIGVERIFY : byte<br /><br />Full name: Script.OP_CHECKSIGVERIFY</div>
<div class="tip" id="fs21">val OP_CHECKMULTISIG : byte<br /><br />Full name: Script.OP_CHECKMULTISIG</div>
<div class="tip" id="fs22">val OP_CHECKMULTISIGVERIFY : byte<br /><br />Full name: Script.OP_CHECKMULTISIGVERIFY</div>
<div class="tip" id="fs23">val OP_DATA_65 : byte<br /><br />Full name: Script.OP_DATA_65</div>
<div class="tip" id="fs24">val OP_DATA_33 : byte<br /><br />Full name: Script.OP_DATA_33</div>
<div class="tip" id="fs25">val scriptToHash : script:byte [] -&gt; byte [] option<br /><br />Full name: Script.scriptToHash</div>
<div class="tip" id="fs26">val script : byte []</div>
<div class="tip" id="fs27">Multiple items<br />val byte : value:&#39;T -&gt; byte (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.byte<br /><br />--------------------<br />type byte = Byte<br /><br />Full name: Microsoft.FSharp.Core.byte</div>
<div class="tip" id="fs28">property Array.Length: int</div>
<div class="tip" id="fs29">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs30">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs31">val isP2SH : script:byte [] -&gt; bool<br /><br />Full name: Script.isP2SH</div>
<div class="tip" id="fs32">val ECDSACheck : txHash:byte [] * pub:byte [] * signature:byte [] -&gt; bool<br /><br />Full name: Script.ECDSACheck</div>
<div class="tip" id="fs33">val txHash : byte []</div>
<div class="tip" id="fs34">val pub : byte []</div>
<div class="tip" id="fs35">val signature : byte []</div>
<div class="tip" id="fs36">val result : obj</div>
<div class="tip" id="fs37">Multiple items<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;new : unit -&gt; List&lt;&#39;T&gt; + 2 overloads<br />&#160;&#160;member Add : item:&#39;T -&gt; unit<br />&#160;&#160;member AddRange : collection:IEnumerable&lt;&#39;T&gt; -&gt; unit<br />&#160;&#160;member AsReadOnly : unit -&gt; ReadOnlyCollection&lt;&#39;T&gt;<br />&#160;&#160;member BinarySearch : item:&#39;T -&gt; int + 2 overloads<br />&#160;&#160;member Capacity : int with get, set<br />&#160;&#160;member Clear : unit -&gt; unit<br />&#160;&#160;member Contains : item:&#39;T -&gt; bool<br />&#160;&#160;member ConvertAll&lt;&#39;TOutput&gt; : converter:Converter&lt;&#39;T, &#39;TOutput&gt; -&gt; List&lt;&#39;TOutput&gt;<br />&#160;&#160;member CopyTo : array:&#39;T[] -&gt; unit + 2 overloads<br />&#160;&#160;...<br />&#160;&#160;nested type Enumerator<br /><br />Full name: System.Collections.Generic.List&lt;_&gt;<br /><br />--------------------<br />List() : unit<br />List(capacity: int) : unit<br />List(collection: IEnumerable&lt;&#39;T&gt;) : unit</div>
<div class="tip" id="fs38">val x : List&lt;&#39;T&gt;</div>
<div class="tip" id="fs39">member List.Push : v:&#39;T -&gt; unit<br /><br />Full name: Script.Push</div>
<div class="tip" id="fs40">val v : &#39;T</div>
<div class="tip" id="fs41">List.Add(item: &#39;T) : unit</div>
<div class="tip" id="fs42">member List.Pop : unit -&gt; &#39;T<br /><br />Full name: Script.Pop</div>
<div class="tip" id="fs43">member List.Peek : unit -&gt; &#39;T</div>
<div class="tip" id="fs44">List.RemoveAt(index: int) : unit</div>
<div class="tip" id="fs45">Multiple items<br />property List.Count: int<br /><br />--------------------<br />(extension) IEnumerable.Count&lt;&#39;TSource&gt;() : int<br />(extension) IEnumerable.Count&lt;&#39;TSource&gt;(predicate: Func&lt;&#39;TSource,bool&gt;) : int</div>
<div class="tip" id="fs46">member List.Peek : unit -&gt; &#39;T<br /><br />Full name: Script.Peek</div>
<div class="tip" id="fs47">property List.Item: int -&gt; &#39;T</div>
<div class="tip" id="fs48">Multiple items<br />type ByteList =<br />&#160;&#160;inherit List&lt;byte []&gt;<br />&#160;&#160;new : unit -&gt; ByteList<br />&#160;&#160;member Push : v:byte [] -&gt; unit<br /><br />Full name: Script.ByteList<br /><br />--------------------<br />new : unit -&gt; ByteList</div>
<div class="tip" id="fs49">val x : ByteList</div>
<div class="tip" id="fs50">member ByteList.Push : v:byte [] -&gt; unit<br /><br />Full name: Script.ByteList.Push</div>
<div class="tip" id="fs51">val v : byte []</div>
<div class="tip" id="fs52">val revFind : arr:byte [] -&gt; f:(byte -&gt; bool) -&gt; int<br /><br />Full name: Script.revFind</div>
<div class="tip" id="fs53">val arr : byte []</div>
<div class="tip" id="fs54">val f : (byte -&gt; bool)</div>
<div class="tip" id="fs55">type bool = Boolean<br /><br />Full name: Microsoft.FSharp.Core.bool</div>
<div class="tip" id="fs56">val rf : (int -&gt; int)</div>
<div class="tip" id="fs57">val i : int</div>
<div class="tip" id="fs58">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs59">val computeTxHash : tx:&#39;a -&gt; index:int -&gt; subScript:byte [] -&gt; sigType:byte -&gt; byte []<br /><br />Full name: Script.computeTxHash</div>
<div class="tip" id="fs60">val tx : &#39;a</div>
<div class="tip" id="fs61">val index : int</div>
<div class="tip" id="fs62">val subScript : byte []</div>
<div class="tip" id="fs63">val sigType : byte</div>
<div class="tip" id="fs64">val mutable returnBuggyHash : bool</div>
<div class="tip" id="fs65">val anyoneCanPay : bool</div>
<div class="tip" id="fs66">val sigHashType : byte</div>
<div class="tip" id="fs67">val oms : MemoryStream</div>
<div class="tip" id="fs68">Multiple items<br />type MemoryStream =<br />&#160;&#160;inherit Stream<br />&#160;&#160;new : unit -&gt; MemoryStream + 6 overloads<br />&#160;&#160;member CanRead : bool<br />&#160;&#160;member CanSeek : bool<br />&#160;&#160;member CanWrite : bool<br />&#160;&#160;member Capacity : int with get, set<br />&#160;&#160;member Flush : unit -&gt; unit<br />&#160;&#160;member GetBuffer : unit -&gt; byte[]<br />&#160;&#160;member Length : int64<br />&#160;&#160;member Position : int64 with get, set<br />&#160;&#160;member Read : buffer:byte[] * offset:int * count:int -&gt; int<br />&#160;&#160;...<br /><br />Full name: System.IO.MemoryStream<br /><br />--------------------<br />MemoryStream() : unit<br />MemoryStream(capacity: int) : unit<br />MemoryStream(buffer: byte []) : unit<br />MemoryStream(buffer: byte [], writable: bool) : unit<br />MemoryStream(buffer: byte [], index: int, count: int) : unit<br />MemoryStream(buffer: byte [], index: int, count: int, writable: bool) : unit<br />MemoryStream(buffer: byte [], index: int, count: int, writable: bool, publiclyVisible: bool) : unit</div>
<div class="tip" id="fs69">val writer : BinaryWriter</div>
<div class="tip" id="fs70">Multiple items<br />type BinaryWriter =<br />&#160;&#160;new : output:Stream -&gt; BinaryWriter + 1 overload<br />&#160;&#160;member BaseStream : Stream<br />&#160;&#160;member Close : unit -&gt; unit<br />&#160;&#160;member Dispose : unit -&gt; unit<br />&#160;&#160;member Flush : unit -&gt; unit<br />&#160;&#160;member Seek : offset:int * origin:SeekOrigin -&gt; int64<br />&#160;&#160;member Write : value:bool -&gt; unit + 17 overloads<br />&#160;&#160;static val Null : BinaryWriter<br /><br />Full name: System.IO.BinaryWriter<br /><br />--------------------<br />BinaryWriter(output: Stream) : unit<br />BinaryWriter(output: Stream, encoding: Text.Encoding) : unit</div>
<div class="tip" id="fs71">BinaryWriter.Write(value: string) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />BinaryWriter.Write(value: float32) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />BinaryWriter.Write(value: uint64) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />BinaryWriter.Write(value: int64) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />BinaryWriter.Write(value: uint32) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />BinaryWriter.Write(value: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />BinaryWriter.Write(value: uint16) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />BinaryWriter.Write(value: int16) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />BinaryWriter.Write(value: decimal) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />BinaryWriter.Write(value: float) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em></div>
<div class="tip" id="fs72">Multiple items<br />type Version =<br />&#160;&#160;new : unit -&gt; Version + 4 overloads<br />&#160;&#160;member Build : int<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CompareTo : version:obj -&gt; int + 1 overload<br />&#160;&#160;member Equals : obj:obj -&gt; bool + 1 overload<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;member Major : int<br />&#160;&#160;member MajorRevision : int16<br />&#160;&#160;member Minor : int<br />&#160;&#160;member MinorRevision : int16<br />&#160;&#160;...<br /><br />Full name: System.Version<br /><br />--------------------<br />Version() : unit<br />Version(version: string) : unit<br />Version(major: int, minor: int) : unit<br />Version(major: int, minor: int, build: int) : unit<br />Version(major: int, minor: int, build: int, revision: int) : unit</div>
<div class="tip" id="fs73">val txIn2 : obj</div>
<div class="tip" id="fs74">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : params indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs75">val iteri : action:(int -&gt; &#39;T -&gt; unit) -&gt; array:&#39;T [] -&gt; unit<br /><br />Full name: Microsoft.FSharp.Collections.Array.iteri</div>
<div class="tip" id="fs76">val txIn : obj</div>
<div class="tip" id="fs77">val empty&lt;&#39;T&gt; : &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.empty</div>
<div class="tip" id="fs78">val txOut : obj</div>
<div class="tip" id="fs79">val i : int32</div>
<div class="tip" id="fs80">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs81">val hash : byte []</div>
<div class="tip" id="fs82">val zeroCreate : count:int -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.zeroCreate</div>
<div class="tip" id="fs83">val data : byte []</div>
<div class="tip" id="fs84">MemoryStream.ToArray() : byte []</div>
<div class="tip" id="fs85">val intToBytes : i:int -&gt; byte []<br /><br />Full name: Script.intToBytes</div>
<div class="tip" id="fs86">val pos : int</div>
<div class="tip" id="fs87">val abs : value:&#39;T -&gt; &#39;T (requires member Abs)<br /><br />Full name: Microsoft.FSharp.Core.Operators.abs</div>
<div class="tip" id="fs88">val bi : byte []</div>
<div class="tip" id="fs89">type BitConverter =<br />&#160;&#160;static val IsLittleEndian : bool<br />&#160;&#160;static member DoubleToInt64Bits : value:float -&gt; int64<br />&#160;&#160;static member GetBytes : value:bool -&gt; byte[] + 9 overloads<br />&#160;&#160;static member Int64BitsToDouble : value:int64 -&gt; float<br />&#160;&#160;static member ToBoolean : value:byte[] * startIndex:int -&gt; bool<br />&#160;&#160;static member ToChar : value:byte[] * startIndex:int -&gt; char<br />&#160;&#160;static member ToDouble : value:byte[] * startIndex:int -&gt; float<br />&#160;&#160;static member ToInt16 : value:byte[] * startIndex:int -&gt; int16<br />&#160;&#160;static member ToInt32 : value:byte[] * startIndex:int -&gt; int<br />&#160;&#160;static member ToInt64 : value:byte[] * startIndex:int -&gt; int64<br />&#160;&#160;...<br /><br />Full name: System.BitConverter</div>
<div class="tip" id="fs90">BitConverter.GetBytes(value: float) : byte []<br />BitConverter.GetBytes(value: float32) : byte []<br />BitConverter.GetBytes(value: uint64) : byte []<br />BitConverter.GetBytes(value: uint32) : byte []<br />BitConverter.GetBytes(value: uint16) : byte []<br />BitConverter.GetBytes(value: int64) : byte []<br />BitConverter.GetBytes(value: int) : byte []<br />BitConverter.GetBytes(value: int16) : byte []<br />BitConverter.GetBytes(value: char) : byte []<br />BitConverter.GetBytes(value: bool) : byte []</div>
<div class="tip" id="fs91">val posTrimIdx : int</div>
<div class="tip" id="fs92">val b : byte</div>
<div class="tip" id="fs93">val iTrimIdx : int</div>
<div class="tip" id="fs94">val bytes : byte []</div>
<div class="tip" id="fs95">val bytesToInt : bytes:byte [] -&gt; Numerics.BigInteger<br /><br />Full name: Script.bytesToInt</div>
<div class="tip" id="fs96">val b : byte []</div>
<div class="tip" id="fs97">Array.Copy(sourceArray: Array, destinationArray: Array, length: int64) : unit<br />Array.Copy(sourceArray: Array, destinationArray: Array, length: int) : unit<br />Array.Copy(sourceArray: Array, sourceIndex: int64, destinationArray: Array, destinationIndex: int64, length: int64) : unit<br />Array.Copy(sourceArray: Array, sourceIndex: int, destinationArray: Array, destinationIndex: int, length: int) : unit</div>
<div class="tip" id="fs98">val neg : bool</div>
<div class="tip" id="fs99">val bi : Numerics.BigInteger</div>
<div class="tip" id="fs100">type bigint = Numerics.BigInteger<br /><br />Full name: Microsoft.FSharp.Core.bigint</div>
<div class="tip" id="fs101">Multiple items<br />type ScriptRuntime =<br />&#160;&#160;new : getTxHash:(byte [] -&gt; byte -&gt; byte []) -&gt; ScriptRuntime<br />&#160;&#160;member CheckSigCount : script:byte [] -&gt; int<br />&#160;&#160;member RedeemScript : script:byte [] -&gt; byte []<br />&#160;&#160;member Verify : inScript:byte [] * outScript:byte [] -&gt; bool<br />&#160;&#160;static member IsP2SH : script:byte [] -&gt; bool<br /><br />Full name: Script.ScriptRuntime<br /><br />--------------------<br />new : getTxHash:(byte [] -&gt; byte -&gt; byte []) -&gt; ScriptRuntime</div>
<div class="tip" id="fs102">val getTxHash : (byte [] -&gt; byte -&gt; byte [])</div>
<div class="tip" id="fs103">val evalStack : ByteList</div>
<div class="tip" id="fs104">val altStack : ByteList</div>
<div class="tip" id="fs105">val ifStack : List&lt;bool&gt;</div>
<div class="tip" id="fs106">val mutable skipping : bool</div>
<div class="tip" id="fs107">val mutable codeSep : int</div>
<div class="tip" id="fs108">val checkDepth : (List&lt;&#39;a&gt; -&gt; int -&gt; unit)</div>
<div class="tip" id="fs109">val stack : List&lt;&#39;a&gt;</div>
<div class="tip" id="fs110">val minDepth : int</div>
<div class="tip" id="fs111">val raise : exn:Exception -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.raise</div>
<div class="tip" id="fs112">val popAsBool : (unit -&gt; bool)</div>
<div class="tip" id="fs113">member List.Pop : unit -&gt; &#39;T</div>
<div class="tip" id="fs114">val verify : (unit -&gt; unit)</div>
<div class="tip" id="fs115">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs116">val fail : (unit -&gt; &#39;a)</div>
<div class="tip" id="fs117">member List.Push : v:&#39;T -&gt; unit<br />member ByteList.Push : v:byte [] -&gt; unit</div>
<div class="tip" id="fs118">val roll : (int -&gt; unit)</div>
<div class="tip" id="fs119">val n : int</div>
<div class="tip" id="fs120">val top : byte []</div>
<div class="tip" id="fs121">property List.Item: int -&gt; byte []</div>
<div class="tip" id="fs122">val dup : (int -&gt; int -&gt; unit)</div>
<div class="tip" id="fs123">val depth : int</div>
<div class="tip" id="fs124">val unaryOp : ((int -&gt; int) -&gt; unit)</div>
<div class="tip" id="fs125">val f : (int -&gt; int)</div>
<div class="tip" id="fs126">val arg : int</div>
<div class="tip" id="fs127">val binaryOp : ((int -&gt; int -&gt; int) -&gt; unit)</div>
<div class="tip" id="fs128">val f : (int -&gt; int -&gt; int)</div>
<div class="tip" id="fs129">val arg2 : int</div>
<div class="tip" id="fs130">val arg1 : int</div>
<div class="tip" id="fs131">val logicalOp : ((bool -&gt; bool -&gt; bool) -&gt; unit)</div>
<div class="tip" id="fs132">val f : (bool -&gt; bool -&gt; bool)</div>
<div class="tip" id="fs133">val arg2 : bool</div>
<div class="tip" id="fs134">val x : int</div>
<div class="tip" id="fs135">val arg1 : bool</div>
<div class="tip" id="fs136">val x : bool</div>
<div class="tip" id="fs137">val binaryBoolOp : ((int -&gt; int -&gt; bool) -&gt; unit)</div>
<div class="tip" id="fs138">val f : (int -&gt; int -&gt; bool)</div>
<div class="tip" id="fs139">val tertiaryOp : ((int -&gt; int -&gt; int -&gt; int) -&gt; unit)</div>
<div class="tip" id="fs140">val f : (int -&gt; int -&gt; int -&gt; int)</div>
<div class="tip" id="fs141">val arg3 : int</div>
<div class="tip" id="fs142">val hashOp : ((byte [] -&gt; byte []) -&gt; unit)</div>
<div class="tip" id="fs143">val f : (byte [] -&gt; byte [])</div>
<div class="tip" id="fs144">val removeData : (byte [] -&gt; (byte [] -&gt; bool) -&gt; bool * byte [] * byte [] [])</div>
<div class="tip" id="fs145">val pred : (byte [] -&gt; bool)</div>
<div class="tip" id="fs146">val dataList : List&lt;byte []&gt;</div>
<div class="tip" id="fs147">val ms : MemoryStream</div>
<div class="tip" id="fs148">val reader : BinaryReader</div>
<div class="tip" id="fs149">Multiple items<br />type BinaryReader =<br />&#160;&#160;new : input:Stream -&gt; BinaryReader + 1 overload<br />&#160;&#160;member BaseStream : Stream<br />&#160;&#160;member Close : unit -&gt; unit<br />&#160;&#160;member Dispose : unit -&gt; unit<br />&#160;&#160;member PeekChar : unit -&gt; int<br />&#160;&#160;member Read : unit -&gt; int + 2 overloads<br />&#160;&#160;member ReadBoolean : unit -&gt; bool<br />&#160;&#160;member ReadByte : unit -&gt; byte<br />&#160;&#160;member ReadBytes : count:int -&gt; byte[]<br />&#160;&#160;member ReadChar : unit -&gt; char<br />&#160;&#160;...<br /><br />Full name: System.IO.BinaryReader<br /><br />--------------------<br />BinaryReader(input: Stream) : unit<br />BinaryReader(input: Stream, encoding: Text.Encoding) : unit</div>
<div class="tip" id="fs150">val removeDataInner : (unit -&gt; byte [])</div>
<div class="tip" id="fs151">property MemoryStream.Position: int64</div>
<div class="tip" id="fs152">property MemoryStream.Length: int64</div>
<div class="tip" id="fs153">BinaryReader.ReadByte() : byte</div>
<div class="tip" id="fs154">val c : int</div>
<div class="tip" id="fs155">val startPos : int64</div>
<div class="tip" id="fs156">val len : int</div>
<div class="tip" id="fs157">BinaryReader.ReadInt16() : int16</div>
<div class="tip" id="fs158">BinaryReader.ReadInt32() : int</div>
<div class="tip" id="fs159">BinaryReader.ReadBytes(count: int) : byte []</div>
<div class="tip" id="fs160">val lenRead : int</div>
<div class="tip" id="fs161">MemoryStream.Seek(offset: int64, loc: SeekOrigin) : int64</div>
<div class="tip" id="fs162">type SeekOrigin =<br />&#160;&#160;| Begin = 0<br />&#160;&#160;| Current = 1<br />&#160;&#160;| End = 2<br /><br />Full name: System.IO.SeekOrigin</div>
<div class="tip" id="fs163">field SeekOrigin.Begin = 0</div>
<div class="tip" id="fs164">List.Add(item: byte []) : unit</div>
<div class="tip" id="fs165">Stream.Dispose() : unit</div>
<div class="tip" id="fs166">(extension) IEnumerable.ToArray&lt;&#39;TSource&gt;() : &#39;TSource []<br />List.ToArray() : byte [] []</div>
<div class="tip" id="fs167">val e : exn</div>
<div class="tip" id="fs168">val currentPos : int</div>
<div class="tip" id="fs169">val removeSignatures : (byte [] -&gt; HashSet&lt;byte []&gt; -&gt; byte [])</div>
<div class="tip" id="fs170">val signatures : HashSet&lt;byte []&gt;</div>
<div class="tip" id="fs171">Multiple items<br />type HashSet&lt;&#39;T&gt; =<br />&#160;&#160;new : unit -&gt; HashSet&lt;&#39;T&gt; + 3 overloads<br />&#160;&#160;member Add : item:&#39;T -&gt; bool<br />&#160;&#160;member Clear : unit -&gt; unit<br />&#160;&#160;member Comparer : IEqualityComparer&lt;&#39;T&gt;<br />&#160;&#160;member Contains : item:&#39;T -&gt; bool<br />&#160;&#160;member CopyTo : array:&#39;T[] -&gt; unit + 2 overloads<br />&#160;&#160;member Count : int<br />&#160;&#160;member ExceptWith : other:IEnumerable&lt;&#39;T&gt; -&gt; unit<br />&#160;&#160;member GetEnumerator : unit -&gt; Enumerator&lt;&#39;T&gt;<br />&#160;&#160;member GetObjectData : info:SerializationInfo * context:StreamingContext -&gt; unit<br />&#160;&#160;...<br />&#160;&#160;nested type Enumerator<br /><br />Full name: System.Collections.Generic.HashSet&lt;_&gt;<br /><br />--------------------<br />HashSet() : unit<br />HashSet(comparer: IEqualityComparer&lt;&#39;T&gt;) : unit<br />HashSet(collection: IEnumerable&lt;&#39;T&gt;) : unit<br />HashSet(collection: IEnumerable&lt;&#39;T&gt;, comparer: IEqualityComparer&lt;&#39;T&gt;) : unit</div>
<div class="tip" id="fs172">val success : bool</div>
<div class="tip" id="fs173">(extension) IEnumerable.Contains&lt;&#39;TSource&gt;(value: &#39;TSource) : bool<br />HashSet.Contains(item: byte []) : bool<br />(extension) IEnumerable.Contains&lt;&#39;TSource&gt;(value: &#39;TSource, comparer: IEqualityComparer&lt;&#39;TSource&gt;) : bool</div>
<div class="tip" id="fs174">val scriptCheckSigCount : (byte [] -&gt; int)</div>
<div class="tip" id="fs175">val ops : byte []</div>
<div class="tip" id="fs176">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs177">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs178">val x : obj</div>
<div class="tip" id="fs179">val op1 : byte</div>
<div class="tip" id="fs180">val op2 : byte</div>
<div class="tip" id="fs181">val sum : source:seq&lt;&#39;T&gt; -&gt; &#39;T (requires member ( + ) and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.Seq.sum</div>
<div class="tip" id="fs182">val checksigInner : (byte [] -&gt; byte [] -&gt; byte [] -&gt; bool)</div>
<div class="tip" id="fs183">val pubScript : byte []</div>
<div class="tip" id="fs184">val checksig : (byte [] -&gt; byte [] -&gt; byte [] -&gt; bool)</div>
<div class="tip" id="fs185">val checkmultisig : (byte [] -&gt; byte [] [] -&gt; byte [] list -&gt; bool)</div>
<div class="tip" id="fs186">val pubs : byte [] []</div>
<div class="tip" id="fs187">val sigs : byte [] list</div>
<div class="tip" id="fs188">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs189">val checkOneSig : (byte [] list -&gt; byte [] -&gt; byte [] list option)</div>
<div class="tip" id="fs190">val pubs : byte [] list</div>
<div class="tip" id="fs191">val tryFindIndex : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; int option<br /><br />Full name: Microsoft.FSharp.Collections.List.tryFindIndex</div>
<div class="tip" id="fs192">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; option:&#39;T option -&gt; &#39;U option<br /><br />Full name: Microsoft.FSharp.Core.Option.map</div>
<div class="tip" id="fs193">val splitAt : index:int -&gt; list:&#39;T list -&gt; &#39;T list * &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.splitAt</div>
<div class="tip" id="fs194">val snd : tuple:(&#39;T1 * &#39;T2) -&gt; &#39;T2<br /><br />Full name: Microsoft.FSharp.Core.Operators.snd</div>
<div class="tip" id="fs195">val tail : list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.tail</div>
<div class="tip" id="fs196">val toList : array:&#39;T [] -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.Array.toList</div>
<div class="tip" id="fs197">val isSome : option:&#39;T option -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Option.isSome</div>
<div class="tip" id="fs198">val eval : (byte [] -&gt; unit)</div>
<div class="tip" id="fs199">val innerEval : (unit -&gt; unit)</div>
<div class="tip" id="fs200">member List.Push : v:&#39;T -&gt; unit</div>
<div class="tip" id="fs201">val t : byte []</div>
<div class="tip" id="fs202">val a : byte []</div>
<div class="tip" id="fs203">List.Insert(index: int, item: byte []) : unit</div>
<div class="tip" id="fs204">val eq : int</div>
<div class="tip" id="fs205">val y : int</div>
<div class="tip" id="fs206">val y : bool</div>
<div class="tip" id="fs207">val a : int</div>
<div class="tip" id="fs208">val b : int</div>
<div class="tip" id="fs209">property BinaryReader.BaseStream: Stream</div>
<div class="tip" id="fs210">property Stream.Position: int64</div>
<div class="tip" id="fs211">val check : bool</div>
<div class="tip" id="fs212">val nPubs : int</div>
<div class="tip" id="fs213">Multiple items<br />val seq : sequence:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.Operators.seq<br /><br />--------------------<br />type seq&lt;&#39;T&gt; = IEnumerable&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.seq&lt;_&gt;</div>
<div class="tip" id="fs214">val toArray : source:seq&lt;&#39;T&gt; -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toArray</div>
<div class="tip" id="fs215">val nSigs : int</div>
<div class="tip" id="fs216">val toList : source:seq&lt;&#39;T&gt; -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toList</div>
<div class="tip" id="fs217">val evalP2SH : (byte [] -&gt; bool)</div>
<div class="tip" id="fs218">List.Clear() : unit</div>
<div class="tip" id="fs219">val redeemScript : byte []</div>
<div class="tip" id="fs220">val redeemScript : (byte [] -&gt; byte [])</div>
<div class="tip" id="fs221">val data : byte [] []</div>
<div class="tip" id="fs222">val last : array:&#39;T [] -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.Array.last</div>
<div class="tip" id="fs223">val x : ScriptRuntime</div>
<div class="tip" id="fs224">member ScriptRuntime.Verify : inScript:byte [] * outScript:byte [] -&gt; bool<br /><br />Full name: Script.ScriptRuntime.Verify</div>
<div class="tip" id="fs225">val inScript : byte []</div>
<div class="tip" id="fs226">val outScript : byte []</div>
<div class="tip" id="fs227">val res : bool</div>
<div class="tip" id="fs228">member ScriptRuntime.CheckSigCount : script:byte [] -&gt; int<br /><br />Full name: Script.ScriptRuntime.CheckSigCount</div>
<div class="tip" id="fs229">member ScriptRuntime.RedeemScript : script:byte [] -&gt; byte []<br /><br />Full name: Script.ScriptRuntime.RedeemScript</div>
<div class="tip" id="fs230">static member ScriptRuntime.IsP2SH : script:byte [] -&gt; bool<br /><br />Full name: Script.ScriptRuntime.IsP2SH</div>
          
        </div>
        <div class="span1"></div>
      </div>
    </div>
  </body>
</html>
